<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lemon - 管理系统</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/leancloud-storage@4.12.0/dist/av-min.js"></script>
    
    <!-- 配置Tailwind自定义主题 - 保持你喜欢的风格 -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#4F86F7',      // 主色调：清新蓝
                        secondary: '#6B5CA5',    // 辅助色：淡紫
                        accent: '#FFB344',       // 强调色：暖黄
                        dark: '#2C3E50',         // 深色
                        light: '#F8FAFC',        // 浅色背景
                    },
                    fontFamily: {
                        main: ['"Nunito"', '"Segoe UI"', 'system-ui', 'sans-serif'],
                    },
                    animation: {
                        'float': 'float 3s ease-in-out infinite',
                        'pulse-slow': 'pulse 4s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                    },
                    keyframes: {
                        float: {
                            '0%, 100%': { transform: 'translateY(0)' },
                            '50%': { transform: 'translateY(-10px)' },
                        }
                    }
                }
            }
        }
    </script>
    
    <style type="text/tailwindcss">
        @layer utilities {
            .content-auto {
                content-visibility: auto;
            }
            .text-shadow {
                text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
            }
            .border-accent {
                border-image: linear-gradient(to right, #4F86F7, #6B5CA5) 1;
            }
            .bg-pattern {
                background-image: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%234f86f7' fill-opacity='0.05'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
            }
        }
    </style>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700&display=swap" rel="stylesheet">
</head>
<body class="bg-light bg-pattern min-h-screen font-main text-dark">
    <!-- 顶部导航栏 -->
    <header class="sticky top-0 z-50 bg-white/90 backdrop-blur-md shadow-md transition-all duration-300">
        <div class="container mx-auto px-4 py-3 flex items-center justify-between">
            <!-- Logo -->
            <div class="flex items-center space-x-2">
                <div class="w-10 h-10 rounded-full bg-gradient-to-r from-primary to-secondary flex items-center justify-center">
                    <i class="fa fa-lemon-o text-white text-xl"></i>
                </div>
                <h1 class="text-2xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-primary to-secondary">Lemon</h1>
            </div>
            
            <!-- 搜索框 -->
            <div class="hidden md:flex relative flex-1 max-w-md mx-8">
                <input id="friendSearch" type="text" placeholder="搜索好友..." 
                    class="w-full py-2 pl-10 pr-4 rounded-full border-2 border-primary/30 focus:border-primary focus:ring-2 focus:ring-primary/20 outline-none transition-all">
                <i class="fa fa-search absolute left-4 top-1/2 -translate-y-1/2 text-gray-400"></i>
                <div id="searchResults" class="absolute top-full left-0 right-0 mt-1 bg-white rounded-lg shadow-lg overflow-hidden hidden z-50"></div>
            </div>
            
            <!-- 用户区域 -->
            <div class="flex items-center space-x-4">
                <button id="mobileSearchBtn" class="md:hidden text-xl">
                    <i class="fa fa-search text-primary"></i>
                </button>
                <div id="userMenu" class="relative">
                    <button id="userAvatarBtn" class="flex items-center space-x-2 focus:outline-none">
                        <div id="userAvatar" class="w-10 h-10 rounded-full bg-gray-200 overflow-hidden border-2 border-primary/50 transition-transform hover:scale-110">
                            <img src="https://picsum.photos/200/200?random=1" alt="用户头像" class="w-full h-full object-cover">
                        </div>
                        <span id="userNickname" class="hidden md:inline font-medium">游客</span>
                        <i class="fa fa-angle-down text-gray-500"></i>
                    </button>
                    <div id="avatarDropdown" class="absolute right-0 mt-2 w-48 bg-white rounded-lg shadow-xl overflow-hidden hidden z-50">
                        <div class="p-3 border-b">
                            <p id="dropdownNickname" class="font-bold">游客</p>
                            <p id="dropdownRole" class="text-sm text-gray-500">未登录</p>
                        </div>
                        <button id="profileBtn" class="w-full text-left px-4 py-2 hover:bg-light transition-colors">
                            <i class="fa fa-user-circle mr-2 text-primary"></i>个人中心
                        </button>
                        <button id="adminBtn" class="w-full text-left px-4 py-2 hover:bg-light transition-colors hidden">
                            <i class="fa fa-crown mr-2 text-accent"></i>管理中心
                        </button>
                        <button id="logoutBtn" class="w-full text-left px-4 py-2 hover:bg-light transition-colors">
                            <i class="fa fa-sign-out mr-2 text-red-500"></i>退出登录
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- 移动端搜索框 -->
        <div id="mobileSearch" class="md:hidden px-4 pb-3 hidden">
            <div class="relative">
                <input type="text" placeholder="搜索好友..." 
                    class="w-full py-2 pl-10 pr-4 rounded-full border-2 border-primary/30 focus:border-primary focus:ring-2 focus:ring-primary/20 outline-none transition-all">
                <i class="fa fa-search absolute left-4 top-1/2 -translate-y-1/2 text-gray-400"></i>
            </div>
        </div>
    </header>

    <!-- 主内容区 -->
    <main class="container mx-auto px-4 py-6 flex flex-col md:flex-row gap-6">
        <!-- 侧边栏 -->
        <aside class="md:w-64 lg:w-72 shrink-0">
            <div class="bg-white rounded-2xl shadow-lg p-4 sticky top-24">
                <nav class="space-y-1">
                    <button class="nav-btn w-full text-left px-4 py-3 rounded-xl flex items-center space-x-3 bg-primary/10 text-primary font-medium">
                        <i class="fa fa-home text-xl w-6 text-center"></i>
                        <span>首页</span>
                    </button>
                    <button class="nav-btn w-full text-left px-4 py-3 rounded-xl flex items-center space-x-3 hover:bg-gray-100 transition-colors">
                        <i class="fa fa-users text-xl w-6 text-center"></i>
                        <span>好友列表</span>
                        <span class="ml-auto bg-primary text-white text-xs px-2 py-1 rounded-full">0</span>
                    </button>
                    <button class="nav-btn w-full text-left px-4 py-3 rounded-xl flex items-center space-x-3 hover:bg-gray-100 transition-colors">
                        <i class="fa fa-question-circle text-xl w-6 text-center"></i>
                        <span>互助问答</span>
                    </button>
                    <button class="nav-btn w-full text-left px-4 py-3 rounded-xl flex items-center space-x-3 hover:bg-gray-100 transition-colors">
                        <i class="fa fa-calendar text-xl w-6 text-center"></i>
                        <span>活动中心</span>
                    </button>
                    <button class="nav-btn w-full text-left px-4 py-3 rounded-xl flex items-center space-x-3 hover:bg-gray-100 transition-colors">
                        <i class="fa fa-bullhorn text-xl w-6 text-center"></i>
                        <span>通知公告</span>
                    </button>
                </nav>
                
                <div class="mt-6 pt-6 border-t border-gray-100">
                    <h3 class="px-4 text-sm font-medium text-gray-500 mb-2">快速链接</h3>
                    <nav class="space-y-1">
                        <button class="nav-btn w-full text-left px-4 py-3 rounded-xl flex items-center space-x-3 hover:bg-gray-100 transition-colors">
                            <i class="fa fa-cog text-xl w-6 text-center"></i>
                            <span>系统设置</span>
                        </button>
                        <button class="nav-btn w-full text-left px-4 py-3 rounded-xl flex items-center space-x-3 hover:bg-gray-100 transition-colors">
                            <i class="fa fa-question-circle text-xl w-6 text-center"></i>
                            <span>帮助中心</span>
                        </button>
                    </nav>
                </div>
                
                <!-- 装饰元素 -->
                <div class="mt-6 relative">
                    <div class="bg-gradient-to-br from-secondary/20 to-primary/20 rounded-xl p-4">
                        <p class="text-sm font-medium">今日状态</p>
                        <p class="text-xs text-gray-600 mt-1">幸运色：<span class="inline-block w-3 h-3 bg-accent rounded-full align-middle"></span> 暖黄</p>
                        <p class="text-xs text-gray-600">状态：一切顺利</p>
                    </div>
                    <div class="absolute -bottom-2 -right-2 w-10 h-10 bg-accent rounded-full flex items-center justify-center animate-float">
                        <i class="fa fa-star text-white"></i>
                    </div>
                </div>
            </div>
        </aside>
        
        <!-- 主内容 -->
        <div class="flex-1">
            <!-- 登录/注册卡片 -->
            <div id="authCard" class="bg-white rounded-2xl shadow-xl p-6 md:p-8 mb-6 transform transition-all duration-500 hover:shadow-2xl">
                <div class="flex flex-col md:flex-row gap-8">
                    <!-- 左侧装饰 -->
                    <div class="md:w-1/2 hidden md:flex flex-col justify-center">
                        <div class="relative">
                            <img src="https://picsum.photos/600/800?random=10" alt="系统封面" class="rounded-xl shadow-lg">
                            <div class="absolute -bottom-4 -left-4 bg-primary text-white p-3 rounded-lg shadow-lg">
                                <p class="font-bold">欢迎使用</p>
                                <p class="text-sm">开启你的旅程吧</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 右侧表单 -->
                    <div class="md:w-1/2">
                        <div class="text-center mb-6">
                            <h2 class="text-3xl font-bold mb-2">欢迎回来</h2>
                            <p class="text-gray-500">请登录你的账号</p>
                        </div>
                        
                        <!-- 登录表单 -->
                        <div id="loginForm">
                            <div class="mb-4">
                                <label class="block text-sm font-medium mb-1" for="loginUsername">昵称</label>
                                <div class="relative">
                                    <span class="absolute inset-y-0 left-0 flex items-center pl-3 text-gray-400">
                                        <i class="fa fa-user"></i>
                                    </span>
                                    <input type="text" id="loginUsername" placeholder="请输入昵称" 
                                        class="w-full pl-10 pr-4 py-3 rounded-xl border border-gray-300 focus:border-primary focus:ring-2 focus:ring-primary/20 outline-none transition-all">
                                </div>
                            </div>
                            
                            <div class="mb-6">
                                <label class="block text-sm font-medium mb-1" for="loginPassword">密码</label>
                                <div class="relative">
                                    <span class="absolute inset-y-0 left-0 flex items-center pl-3 text-gray-400">
                                        <i class="fa fa-lock"></i>
                                    </span>
                                    <input type="password" id="loginPassword" placeholder="请输入8位密码" 
                                        class="w-full pl-10 pr-10 py-3 rounded-xl border border-gray-300 focus:border-primary focus:ring-2 focus:ring-primary/20 outline-none transition-all">
                                    <button type="button" class="absolute inset-y-0 right-0 flex items-center pr-3 text-gray-400 toggle-password">
                                        <i class="fa fa-eye"></i>
                                    </button>
                                    <p id="passwordError" class="mt-1 text-xs text-red-500 hidden">密码必须为8位</p>
                                </div>
                            </div>
                            
                            <button id="loginBtn" class="w-full bg-gradient-to-r from-primary to-secondary text-white py-3 rounded-xl font-medium hover:opacity-90 transition-opacity mb-4">
                                登录
                            </button>
                            
                            <div class="text-center text-sm">
                                <p>还没有账号？ <button id="showRegisterBtn" class="text-primary font-medium">立即注册</button></p>
                            </div>
                        </div>
                        
                        <!-- 注册表单 -->
                        <div id="registerForm" class="hidden">
                            <div class="mb-4">
                                <label class="block text-sm font-medium mb-1" for="regUsername">昵称</label>
                                <div class="relative">
                                    <span class="absolute inset-y-0 left-0 flex items-center pl-3 text-gray-400">
                                        <i class="fa fa-user"></i>
                                    </span>
                                    <input type="text" id="regUsername" placeholder="请设置昵称" 
                                        class="w-full pl-10 pr-4 py-3 rounded-xl border border-gray-300 focus:border-primary focus:ring-2 focus:ring-primary/20 outline-none transition-all">
                                </div>
                            </div>
                            
                            <div class="mb-6">
                                <label class="block text-sm font-medium mb-1" for="regPassword">密码</label>
                                <div class="relative">
                                    <span class="absolute inset-y-0 left-0 flex items-center pl-3 text-gray-400">
                                        <i class="fa fa-lock"></i>
                                    </span>
                                    <input type="password" id="regPassword" placeholder="请设置8位密码" 
                                        class="w-full pl-10 pr-10 py-3 rounded-xl border border-gray-300 focus:border-primary focus:ring-2 focus:ring-primary/20 outline-none transition-all">
                                    <button type="button" class="absolute inset-y-0 right-0 flex items-center pr-3 text-gray-400 toggle-password">
                                        <i class="fa fa-eye"></i>
                                    </button>
                                    <p id="regPasswordError" class="mt-1 text-xs text-red-500 hidden">密码必须为8位</p>
                                </div>
                            </div>
                            
                            <button id="registerBtn" class="w-full bg-gradient-to-r from-secondary to-primary text-white py-3 rounded-xl font-medium hover:opacity-90 transition-opacity mb-4">
                                注册
                            </button>
                            
                            <div class="text-center text-sm">
                                <p>已有账号？ <button id="showLoginBtn" class="text-primary font-medium">立即登录</button></p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- 首页内容 -->
            <div id="homeContent" class="hidden">
                <!-- 欢迎卡片 -->
                <div class="bg-gradient-to-r from-primary/10 to-secondary/10 rounded-2xl p-6 md:p-8 mb-6 relative overflow-hidden">
                    <div class="absolute top-0 right-0 w-40 h-40 bg-accent/10 rounded-full -mr-20 -mt-20"></div>
                    <div class="absolute bottom-0 left-0 w-60 h-60 bg-primary/10 rounded-full -ml-30 -mb-30"></div>
                    
                    <div class="relative z-10 flex flex-col md:flex-row items-start md:items-center justify-between">
                        <div>
                            <h2 class="text-2xl md:text-3xl font-bold mb-2">欢迎回来，<span id="welcomeNickname">用户</span>！</h2>
                            <p class="text-gray-600" id="welcomeRole">普通用户</p>
                        </div>
                        
                        <div class="mt-4 md:mt-0 flex space-x-3">
                            <button class="bg-white text-primary px-4 py-2 rounded-lg shadow hover:shadow-md transition-shadow flex items-center">
                                <i class="fa fa-plus mr-2"></i>发布动态
                            </button>
                            <button class="bg-white text-secondary px-4 py-2 rounded-lg shadow hover:shadow-md transition-shadow">
                                <i class="fa fa-envelope"></i>
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- 功能卡片区 -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-6">
                    <div class="bg-white rounded-2xl shadow-lg p-6 hover:shadow-xl transition-shadow transform hover:-translate-y-1 duration-300">
                        <div class="w-12 h-12 bg-primary/20 rounded-xl flex items-center justify-center mb-4">
                            <i class="fa fa-users text-primary text-xl"></i>
                        </div>
                        <h3 class="text-xl font-bold mb-2">好友管理</h3>
                        <p class="text-gray-600 text-sm mb-4">查看好友列表，添加新好友，维系社交关系</p>
                        <button id="toFriendsBtn" class="text-primary font-medium flex items-center">
                            查看好友 <i class="fa fa-arrow-right ml-2"></i>
                        </button>
                    </div>
                    
                    <div class="bg-white rounded-2xl shadow-lg p-6 hover:shadow-xl transition-shadow transform hover:-translate-y-1 duration-300">
                        <div class="w-12 h-12 bg-secondary/20 rounded-xl flex items-center justify-center mb-4">
                            <i class="fa fa-question-circle text-secondary text-xl"></i>
                        </div>
                        <h3 class="text-xl font-bold mb-2">互助问答</h3>
                        <p class="text-gray-600 text-sm mb-4">提出你的疑问，解答他人困惑，共同进步</p>
                        <button class="text-secondary font-medium flex items-center">
                            进入问答 <i class="fa fa-arrow-right ml-2"></i>
                        </button>
                    </div>
                    
                    <div class="bg-white rounded-2xl shadow-lg p-6 hover:shadow-xl transition-shadow transform hover:-translate-y-1 duration-300">
                        <div class="w-12 h-12 bg-accent/20 rounded-xl flex items-center justify-center mb-4">
                            <i class="fa fa-calendar text-accent text-xl"></i>
                        </div>
                        <h3 class="text-xl font-bold mb-2">活动中心</h3>
                        <p class="text-gray-600 text-sm mb-4">浏览最新活动，报名参与，丰富生活</p>
                        <button class="text-accent font-medium flex items-center">
                            查看活动 <i class="fa fa-arrow-right ml-2"></i>
                        </button>
                    </div>
                </div>
                
                <!-- 动态区域 -->
                <div class="bg-white rounded-2xl shadow-lg p-6 mb-6">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-xl font-bold">最新动态</h2>
                        <button class="text-gray-500 hover:text-primary transition-colors">
                            查看全部 <i class="fa fa-angle-right ml-1"></i>
                        </button>
                    </div>
                    
                    <!-- 动态列表 -->
                    <div class="space-y-6">
                        <div class="border-b border-gray-100 pb-6">
                            <div class="flex items-center mb-4">
                                <div class="w-10 h-10 rounded-full overflow-hidden mr-3">
                                    <img src="https://picsum.photos/200/200?random=2" alt="用户头像" class="w-full h-full object-cover">
                                </div>
                                <div>
                                    <p class="font-medium">用户A</p>
                                    <p class="text-xs text-gray-500">2小时前</p>
                                </div>
                            </div>
                            <p class="mb-4">今天的活动太精彩了！大家都去看了吗？分享几张现场照片~</p>
                            <div class="grid grid-cols-3 gap-2 mb-4">
                                <img src="https://picsum.photos/300/300?random=21" alt="活动照片" class="rounded-lg w-full h-24 object-cover">
                                <img src="https://picsum.photos/300/300?random=22" alt="活动照片" class="rounded-lg w-full h-24 object-cover">
                                <img src="https://picsum.photos/300/300?random=23" alt="活动照片" class="rounded-lg w-full h-24 object-cover">
                            </div>
                            <div class="flex items-center text-gray-500 text-sm">
                                <button class="flex items-center hover:text-primary transition-colors mr-4">
                                    <i class="fa fa-heart-o mr-1"></i> 点赞 (24)
                                </button>
                                <button class="flex items-center hover:text-primary transition-colors">
                                    <i class="fa fa-comment-o mr-1"></i> 评论 (8)
                                </button>
                            </div>
                        </div>
                        
                        <div>
                            <div class="flex items-center mb-4">
                                <div class="w-10 h-10 rounded-full overflow-hidden mr-3">
                                    <img src="https://picsum.photos/200/200?random=3" alt="用户头像" class="w-full h-full object-cover">
                                </div>
                                <div>
                                    <p class="font-medium">用户B</p>
                                    <p class="text-xs text-gray-500">昨天 18:30</p>
                                </div>
                            </div>
                            <p class="mb-4">整理了一些学习资料，需要的朋友可以私信我~ #学习互助#</p>
                            <div class="bg-gray-100 rounded-lg p-3 mb-4">
                                <div class="flex items-center">
                                    <i class="fa fa-file-text-o text-gray-500 mr-2"></i>
                                    <p class="text-sm">学习资料汇总.pdf</p>
                                </div>
                            </div>
                            <div class="flex items-center text-gray-500 text-sm">
                                <button class="flex items-center hover:text-primary transition-colors mr-4">
                                    <i class="fa fa-heart-o mr-1"></i> 点赞 (56)
                                </button>
                                <button class="flex items-center hover:text-primary transition-colors">
                                    <i class="fa fa-comment-o mr-1"></i> 评论 (12)
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- 个人中心 -->
            <div id="profileContent" class="hidden">
                <div class="bg-white rounded-2xl shadow-lg p-6 md:p-8 mb-6">
                    <h2 class="text-2xl font-bold mb-6">个人中心</h2>
                    
                    <div class="flex flex-col md:flex-row gap-8">
                        <!-- 头像区域 -->
                        <div class="md:w-1/3 flex flex-col items-center">
                            <div class="relative mb-4">
                                <div id="profileAvatar" class="w-40 h-40 rounded-full overflow-hidden border-4 border-primary/30 shadow-lg">
                                    <img src="https://picsum.photos/200/200?random=1" alt="用户头像" class="w-full h-full object-cover">
                                </div>
                                <button id="changeAvatarBtn" class="absolute bottom-0 right-0 w-10 h-10 bg-primary rounded-full flex items-center justify-center text-white shadow-md hover:bg-primary/90 transition-colors">
                                    <i class="fa fa-camera"></i>
                                </button>
                                <input type="file" id="avatarInput" accept="image/*" class="hidden">
                            </div>
                            
                            <h3 id="profileNickname" class="text-xl font-bold mb-1">用户名</h3>
                            <p id="profileRole" class="text-gray-500 mb-4">普通用户</p>
                            
                            <button id="editProfileBtn" class="bg-primary/10 text-primary px-6 py-2 rounded-lg hover:bg-primary/20 transition-colors">
                                编辑资料
                            </button>
                        </div>
                        
                        <!-- 信息区域 -->
                        <div class="md:w-2/3">
                            <div class="space-y-6">
                                <div>
                                    <h4 class="text-sm font-medium text-gray-500 mb-2">基本信息</h4>
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                        <div class="bg-gray-50 p-4 rounded-xl">
                                            <p class="text-sm text-gray-500 mb-1">昵称</p>
                                            <p id="infoNickname" class="font-medium">用户名</p>
                                        </div>
                                        <div class="bg-gray-50 p-4 rounded-xl">
                                            <p class="text-sm text-gray-500 mb-1">角色</p>
                                            <p id="infoRole" class="font-medium">普通用户</p>
                                        </div>
                                        <div class="bg-gray-50 p-4 rounded-xl">
                                            <p class="text-sm text-gray-500 mb-1">注册时间</p>
                                            <p id="infoRegTime" class="font-medium">--</p>
                                        </div>
                                        <div class="bg-gray-50 p-4 rounded-xl">
                                            <p class="text-sm text-gray-500 mb-1">好友数量</p>
                                            <p id="infoFriendCount" class="font-medium">0</p>
                                        </div>
                                    </div>
                                </div>
                                
                                <div>
                                    <h4 class="text-sm font-medium text-gray-500 mb-2">账号安全</h4>
                                    <div class="bg-gray-50 p-4 rounded-xl">
                                        <div class="flex justify-between items-center">
                                            <div>
                                                <p class="font-medium">修改密码</p>
                                                <p class="text-sm text-gray-500">建议定期更换密码，保障账号安全</p>
                                            </div>
                                            <button id="changePwdBtn" class="text-primary hover:text-primary/80 transition-colors">
                                                更改 <i class="fa fa-angle-right ml-1"></i>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- 好友列表 -->
            <div id="friendsContent" class="hidden">
                <div class="bg-white rounded-2xl shadow-lg p-6 mb-6">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-2xl font-bold">好友列表</h2>
                        <button id="addFriendBtn" class="bg-primary text-white px-4 py-2 rounded-lg hover:bg-primary/90 transition-colors flex items-center">
                            <i class="fa fa-plus mr-2"></i>添加好友
                        </button>
                    </div>
                    
                    <!-- 好友搜索 -->
                    <div class="relative mb-6">
                        <input type="text" placeholder="搜索好友..." 
                            class="w-full pl-10 pr-4 py-3 rounded-xl border border-gray-300 focus:border-primary focus:ring-2 focus:ring-primary/20 outline-none transition-all">
                        <i class="fa fa-search absolute left-4 top-1/2 -translate-y-1/2 text-gray-400"></i>
                    </div>
                    
                    <!-- 好友列表 -->
                    <div id="friendsList" class="space-y-4">
                        <p class="text-center text-gray-500 py-8">暂无好友，快去添加吧~</p>
                        <!-- 好友项将通过JS动态添加 -->
                    </div>
                </div>
            </div>
            
            <!-- 管理中心 -->
            <div id="adminContent" class="hidden">
                <div class="bg-white rounded-2xl shadow-lg p-6 mb-6">
                    <h2 class="text-2xl font-bold mb-6">管理中心</h2>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                        <div class="bg-primary/10 rounded-xl p-6 flex items-center">
                            <div class="w-16 h-16 bg-primary/20 rounded-full flex items-center justify-center mr-4">
                                <i class="fa fa-users text-primary text-2xl"></i>
                            </div>
                            <div>
                                <p class="text-gray-500 text-sm">总用户数</p>
                                <p id="totalUsers" class="text-3xl font-bold">0</p>
                            </div>
                        </div>
                        
                        <div class="bg-secondary/10 rounded-xl p-6 flex items-center">
                            <div class="w-16 h-16 bg-secondary/20 rounded-full flex items-center justify-center mr-4">
                                <i class="fa fa-question-circle text-secondary text-2xl"></i>
                            </div>
                            <div>
                                <p class="text-gray-500 text-sm">问答总数</p>
                                <p id="totalQuestions" class="text-3xl font-bold">0</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 用户管理 -->
                    <div>
                        <h3 class="text-xl font-bold mb-4">用户管理</h3>
                        <div class="overflow-x-auto">
                            <table class="w-full">
                                <thead>
                                    <tr class="border-b border-gray-200">
                                        <th class="text-left py-3 px-4">ID</th>
                                        <th class="text-left py-3 px-4">昵称</th>
                                        <th class="text-left py-3 px-4">角色</th>
                                        <th class="text-left py-3 px-4">注册时间</th>
                                        <th class="text-left py-3 px-4">操作</th>
                                    </tr>
                                </thead>
                                <tbody id="usersTableBody">
                                    <!-- 用户数据将通过JS动态添加 -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- 页脚 -->
    <footer class="bg-dark text-white py-10 mt-10">
        <div class="container mx-auto px-4">
            <div class="flex flex-col md:flex-row justify-between">
                <div class="mb-6 md:mb-0">
                    <div class="flex items-center space-x-2 mb-4">
                        <div class="w-10 h-10 rounded-full bg-gradient-to-r from-primary to-secondary flex items-center justify-center">
                            <i class="fa fa-lemon-o text-white text-xl"></i>
                        </div>
                        <h2 class="text-2xl font-bold">Lemon</h2>
                    </div>
                    <p class="text-gray-400 max-w-md">简洁高效的管理系统，连接每一位用户，提供优质体验。</p>
                </div>
                
                <div class="grid grid-cols-2 md:grid-cols-3 gap-8">
                    <div>
                        <h3 class="text-lg font-bold mb-4">快速链接</h3>
                        <ul class="space-y-2 text-gray-400">
                            <li><a href="#" class="hover:text-primary transition-colors">首页</a></li>
                            <li><a href="#" class="hover:text-primary transition-colors">互助问答</a></li>
                            <li><a href="#" class="hover:text-primary transition-colors">活动中心</a></li>
                        </ul>
                    </div>
                    
                    <div>
                        <h3 class="text-lg font-bold mb-4">关于我们</h3>
                        <ul class="space-y-2 text-gray-400">
                            <li><a href="#" class="hover:text-primary transition-colors">关于系统</a></li>
                            <li><a href="#" class="hover:text-primary transition-colors">使用帮助</a></li>
                            <li><a href="#" class="hover:text-primary transition-colors">联系我们</a></li>
                        </ul>
                    </div>
                    
                    <div class="col-span-2 md:col-span-1">
                        <h3 class="text-lg font-bold mb-4">关注我们</h3>
                        <div class="flex space-x-4">
                            <a href="#" class="w-10 h-10 rounded-full bg-white/10 flex items-center justify-center hover:bg-primary transition-colors">
                                <i class="fa fa-weibo"></i>
                            </a>
                            <a href="#" class="w-10 h-10 rounded-full bg-white/10 flex items-center justify-center hover:bg-primary transition-colors">
                                <i class="fa fa-wechat"></i>
                            </a>
                            <a href="#" class="w-10 h-10 rounded-full bg-white/10 flex items-center justify-center hover:bg-primary transition-colors">
                                <i class="fa fa-qq"></i>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="border-t border-white/10 mt-8 pt-8 text-center text-gray-500 text-sm">
                <p>© 2025 lemon版权所有</p>
            </div>
        </div>
    </footer>

    <!-- 模态框：添加好友 -->
    <div id="addFriendModal" class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-md p-6 transform transition-all">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-bold">添加好友</h3>
                <button id="closeAddFriendModal" class="text-gray-500 hover:text-gray-700">
                    <i class="fa fa-times text-xl"></i>
                </button>
            </div>
            
            <div class="mb-4">
                <label class="block text-sm font-medium mb-1" for="addFriendUsername">好友昵称</label>
                <input type="text" id="addFriendUsername" placeholder="请输入好友昵称" 
                    class="w-full px-4 py-3 rounded-xl border border-gray-300 focus:border-primary focus:ring-2 focus:ring-primary/20 outline-none transition-all">
            </div>
            
            <div class="mb-6">
                <label class="block text-sm font-medium mb-1" for="addFriendMessage">验证消息</label>
                <textarea id="addFriendMessage" rows="3" placeholder="请输入验证消息..." 
                    class="w-full px-4 py-3 rounded-xl border border-gray-300 focus:border-primary focus:ring-2 focus:ring-primary/20 outline-none transition-all"></textarea>
            </div>
            
            <button id="confirmAddFriendBtn" class="w-full bg-primary text-white py-3 rounded-xl font-medium hover:bg-primary/90 transition-colors">
                发送请求
            </button>
        </div>
    </div>

    <!-- 模态框：修改密码 -->
    <div id="changePwdModal" class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-md p-6 transform transition-all">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-bold">修改密码</h3>
                <button id="closeChangePwdModal" class="text-gray-500 hover:text-gray-700">
                    <i class="fa fa-times text-xl"></i>
                </button>
            </div>
            
            <div class="mb-4">
                <label class="block text-sm font-medium mb-1" for="oldPassword">原密码</label>
                <input type="password" id="oldPassword" placeholder="请输入原密码" 
                    class="w-full px-4 py-3 rounded-xl border border-gray-300 focus:border-primary focus:ring-2 focus:ring-primary/20 outline-none transition-all">
            </div>
            
            <div class="mb-4">
                <label class="block text-sm font-medium mb-1" for="newPassword">新密码</label>
                <input type="password" id="newPassword" placeholder="请输入8位新密码" 
                    class="w-full px-4 py-3 rounded-xl border border-gray-300 focus:border-primary focus:ring-2 focus:ring-primary/20 outline-none transition-all">
                <p id="newPwdError" class="mt-1 text-xs text-red-500 hidden">密码必须为8位</p>
            </div>
            
            <div class="mb-6">
                <label class="block text-sm font-medium mb-1" for="confirmPassword">确认新密码</label>
                <input type="password" id="confirmPassword" placeholder="请再次输入新密码" 
                    class="w-full px-4 py-3 rounded-xl border border-gray-300 focus:border-primary focus:ring-2 focus:ring-primary/20 outline-none transition-all">
                <p id="confirmPwdError" class="mt-1 text-xs text-red-500 hidden">两次输入的密码不一致</p>
            </div>
            
            <button id="confirmChangePwdBtn" class="w-full bg-primary text-white py-3 rounded-xl font-medium hover:bg-primary/90 transition-colors">
                确认修改
            </button>
        </div>
    </div>

    <!-- 成功提示 -->
    <div id="successToast" class="fixed bottom-6 right-6 bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg transform translate-y-20 opacity-0 transition-all duration-300 flex items-center z-50">
        <i class="fa fa-check-circle mr-2"></i>
        <span id="successMessage">操作成功</span>
    </div>

    <!-- 错误提示 -->
    <div id="errorToast" class="fixed bottom-6 right-6 bg-red-500 text-white px-6 py-3 rounded-lg shadow-lg transform translate-y-20 opacity-0 transition-all duration-300 flex items-center z-50">
        <i class="fa fa-exclamation-circle mr-2"></i>
        <span id="errorMessage">操作失败</span>
    </div>

    <script>
        // 初始化LeanCloud
        AV.init({
            appId: "30kUc571qTv0YSCTWVGRbAxk-gzGzoHsz",
            appKey: "ZfVrHcQ41Hm8rKkF1cCjXlCn",
            serverURL: "https://30kuc571.lc-cn-n1-shared.com"
        });

        // 配置
        const Config = {
            ROLES: {
                SUPER_ADMIN: 'super_admin',
                ADMIN: 'admin',
                USER: 'user'
            }
        };

        // 全局状态
        const State = {
            currentUser: null,
            currentRole: Config.ROLES.USER,
            isLoggedIn: false
        };

        // 工具函数
        const Utils = {
            // 显示提示
            showToast: (type, message) => {
                const toast = document.getElementById(`${type}Toast`);
                const messageEl = document.getElementById(`${type}Message`);
                
                messageEl.textContent = message;
                toast.classList.remove('translate-y-20', 'opacity-0');
                
                setTimeout(() => {
                    toast.classList.add('translate-y-20', 'opacity-0');
                }, 3000);
            },
            
            // 显示成功提示
            showSuccess: (message) => {
                Utils.showToast('success', message);
            },
            
            // 显示错误提示
            showError: (message) => {
                Utils.showToast('error', message);
            },
            
            // 格式化日期
            formatDate: (dateString) => {
                const date = new Date(dateString);
                return `${date.getFullYear()}-${(date.getMonth() + 1).toString().padStart(2, '0')}-${date.getDate().toString().padStart(2, '0')} ${date.getHours().toString().padStart(2, '0')}:${date.getMinutes().toString().padStart(2, '0')}`;
            }
        };

        // 认证相关
        const Auth = {
            // 初始化
            init: async () => {
                try {
                    // 先确保超管账号存在
                    await Auth.ensureSuperAdminExists();
                    
                    // 检查当前登录状态
                    const currentUser = AV.User.current();
                    if (currentUser) {
                        State.currentUser = currentUser.toJSON();
                        State.isLoggedIn = true;
                        await Auth.checkUserRole();
                        Auth.updateUserInfoDisplay();
                        UI.showContent('homeContent');
                    } else {
                        UI.showContent('authCard');
                    }
                } catch (err) {
                    console.error('初始化失败:', err);
                    Utils.showError('系统初始化失败，请刷新页面重试');
                }
            },
            
            // 确保超级管理员存在 - 优化版本，确保账号100%创建
            ensureSuperAdminExists: async () => {
                try {
                    // 1. 确保super_admin角色存在
                    let superAdminRole;
                    const roleQuery = new AV.Query(AV.Role);
                    roleQuery.equalTo('name', Config.ROLES.SUPER_ADMIN);
                    const roles = await roleQuery.find();
                    
                    if (roles.length === 0) {
                        // 创建super_admin角色
                        superAdminRole = new AV.Role(Config.ROLES.SUPER_ADMIN, new AV.ACL());
                        superAdminRole.getACL().setPublicReadAccess(true);
                        superAdminRole.getACL().setPublicWriteAccess(false);
                        await superAdminRole.save();
                        console.log('已创建super_admin角色');
                    } else {
                        superAdminRole = roles[0];
                    }
                    
                    // 2. 确保lemon用户存在
                    let lemonUser;
                    const userQuery = new AV.Query(AV.User);
                    userQuery.equalTo('username', 'lemon');
                    const users = await userQuery.find();
                    
                    if (users.length === 0) {
                        // 创建lemon用户（密码ning6666）
                        lemonUser = new AV.User();
                        lemonUser.setUsername('lemon');
                        lemonUser.setPassword('ning6666');
                        await lemonUser.signUp();
                        console.log('已创建lemon用户');
                    } else {
                        lemonUser = users[0];
                    }
                    
                    // 3. 确保lemon用户在super_admin角色中
                    const roleUsers = await superAdminRole.getUsersQuery().find();
                    const isInRole = roleUsers.some(u => u.id === lemonUser.id);
                    
                    if (!isInRole) {
                        superAdminRole.getUsers().add(lemonUser);
                        await superAdminRole.save();
                        console.log('已将lemon用户添加到super_admin角色');
                    }
                    
                    // 4. 确保用户密码正确（关键修复）
                    if (users.length > 0) {
                        try {
                            // 尝试用正确密码登录一次，确保密码正确
                            await AV.User.logIn('lemon', 'ning6666');
                            await AV.User.logOut(); // 登录后立即退出，不影响当前状态
                            console.log('超管账号密码验证成功');
                        } catch (err) {
                            console.log('超管密码错误，尝试重置');
                            // 如果密码错误，尝试重置密码
                            lemonUser.setPassword('ning6666');
                            await lemonUser.save(null, { useMasterKey: true });
                            console.log('已重置超管密码为ning6666');
                        }
                    }
                    
                    return true;
                } catch (err) {
                    console.error('确保超级管理员存在失败:', err);
                    // 显示更详细的错误信息，帮助调试
                    Utils.showError(`超管账号创建失败: ${err.message || '未知错误'}`);
                    return false;
                }
            },
            
            // 检查用户角色
            checkUserRole: async () => {
                if (!State.currentUser) return;
                
                try {
                    const user = AV.Object.createWithoutData('_User', State.currentUser.objectId);
                    const query = new AV.Query(AV.Role);
                    query.equalTo('users', user);
                    
                    const roles = await query.find();
                    console.log('查询到的角色:', roles.map(role => role.get('name')));
                    
                    // 优先识别super_admin角色
                    let newRole = Config.ROLES.USER;
                    if (roles.length > 0) {
                        const isSuperAdmin = roles.some(role => role.get('name') === Config.ROLES.SUPER_ADMIN);
                        const isAdmin = roles.some(role => role.get('name') === Config.ROLES.ADMIN);
                        
                        if (isSuperAdmin) {
                            newRole = Config.ROLES.SUPER_ADMIN;
                        } else if (isAdmin) {
                            newRole = Config.ROLES.ADMIN;
                        }
                    }
                    
                    State.currentRole = newRole;
                    console.log('当前用户角色:', newRole);
                    return newRole;
                } catch (err) {
                    console.error('获取用户角色失败:', err);
                    State.currentRole = Config.ROLES.USER;
                    return Config.ROLES.USER;
                }
            },
            
            // 登录
            login: async (username, password) => {
                // 验证密码长度
                if (password.length !== 8) {
                    document.getElementById('passwordError').classList.remove('hidden');
                    return false;
                }
                
                try {
                    // 关键修复：清除当前登录状态再尝试登录
                    await AV.User.logOut();
                    
                    const user = await AV.User.logIn(username, password);
                    State.currentUser = user.toJSON();
                    State.isLoggedIn = true;
                    await Auth.checkUserRole();
                    Auth.updateUserInfoDisplay();
                    
                    Utils.showSuccess('登录成功');
                    return true;
                } catch (err) {
                    console.error('登录失败:', err);
                    // 显示更详细的错误信息
                    let errorMsg = '登录失败';
                    if (err.code === 210) errorMsg = '用户名或密码错误';
                    else if (err.code === 211) errorMsg = '用户不存在';
                    else errorMsg = `登录失败: ${err.message}`;
                    
                    Utils.showError(errorMsg);
                    return false;
                }
            },
            
            // 注册
            register: async (username, password) => {
                // 验证密码长度
                if (password.length !== 8) {
                    document.getElementById('regPasswordError').classList.remove('hidden');
                    return false;
                }
                
                try {
                    // 检查用户名是否已存在
                    const query = new AV.Query(AV.User);
                    query.equalTo('username', username);
                    const users = await query.find();
                    
                    if (users.length > 0) {
                        Utils.showError('用户名已存在');
                        return false;
                    }
                    
                    // 创建用户
                    const user = new AV.User();
                    user.setUsername(username);
                    user.setPassword(password);
                    await user.signUp();
                    
                    // 设置默认角色为普通用户
                    const roleQuery = new AV.Query(AV.Role);
                    roleQuery.equalTo('name', Config.ROLES.USER);
                    const roles = await roleQuery.find();
                    
                    let userRole;
                    if (roles.length === 0) {
                        userRole = new AV.Role(Config.ROLES.USER, new AV.ACL());
                        userRole.getACL().setPublicReadAccess(true);
                        await userRole.save();
                    } else {
                        userRole = roles[0];
                    }
                    
                    userRole.getUsers().add(user);
                    await userRole.save();
                    
                    Utils.showSuccess('注册成功，请登录');
                    return true;
                } catch (err) {
                    console.error('注册失败:', err);
                    Utils.showError('注册失败，请稍后再试');
                    return false;
                }
            },
            
            // 退出登录
            logout: async () => {
                try {
                    await AV.User.logOut();
                    State.currentUser = null;
                    State.currentRole = Config.ROLES.USER;
                    State.isLoggedIn = false;
                    
                    Auth.updateUserInfoDisplay();
                    UI.showContent('authCard');
                    Utils.showSuccess('已退出登录');
                } catch (err) {
                } catch (err) {
                    console.error('退出登录失败:', err);
                    Utils.showError('退出登录失败，请稍后再试');
                }
            },
            
            // 更新用户信息显示
            updateUserInfoDisplay: () => {
                const userAvatar = document.getElementById('userAvatar');
                const userNickname = document.getElementById('userNickname');
                const dropdownNickname = document.getElementById('dropdownNickname');
                const dropdownRole = document.getElementById('dropdownRole');
                const adminBtn = document.getElementById('adminBtn');
                
                const welcomeNickname = document.getElementById('welcomeNickname');
                const welcomeRole = document.getElementById('welcomeRole');
                
                const profileNickname = document.getElementById('profileNickname');
                const profileRole = document.getElementById('profileRole');
                const infoNickname = document.getElementById('infoNickname');
                const infoRole = document.getElementById('infoRole');
                const infoRegTime = document.getElementById('infoRegTime');
                
                if (State.isLoggedIn) {
                    // 设置头像
                    const avatarUrl = State.currentUser.avatar || `https://picsum.photos/200/200?random=${State.currentUser.objectId}`;
                    userAvatar.innerHTML = `<img src="${avatarUrl}" alt="用户头像" class="w-full h-full object-cover">`;
                    document.getElementById('profileAvatar').innerHTML = `<img src="${avatarUrl}" alt="用户头像" class="w-full h-full object-cover">`;
                    
                    // 设置昵称
                    userNickname.textContent = State.currentUser.username;
                    dropdownNickname.textContent = State.currentUser.username;
                    welcomeNickname.textContent = State.currentUser.username;
                    profileNickname.textContent = State.currentUser.username;
                    infoNickname.textContent = State.currentUser.username;
                    
                    // 设置角色
                    let roleText = '普通用户';
                    if (State.currentRole === Config.ROLES.SUPER_ADMIN) {
                        roleText = '👑超级管理员';
                        adminBtn.classList.remove('hidden');
                    } else if (State.currentRole === Config.ROLES.ADMIN) {
                        roleText = '🛡️管理员';
                        adminBtn.classList.remove('hidden');
                    } else {
                        adminBtn.classList.add('hidden');
                    }
                    
                    dropdownRole.textContent = roleText;
                    welcomeRole.textContent = roleText;
                    profileRole.textContent = roleText;
                    infoRole.textContent = roleText;
                    
                    // 设置注册时间
                    if (State.currentUser.createdAt) {
                        infoRegTime.textContent = Utils.formatDate(State.currentUser.createdAt);
                    }
                    
                    // 加载用户管理数据（如果是管理员）
                    if (State.currentRole === Config.ROLES.SUPER_ADMIN || State.currentRole === Config.ROLES.ADMIN) {
                        Admin.loadUsers();
                    }
                    
                    // 加载好友列表
                    Friends.loadFriends();
                } else {
                    // 未登录状态
                    userAvatar.innerHTML = `<img src="https://picsum.photos/200/200?random=1" alt="游客头像" class="w-full h-full object-cover">`;
                    userNickname.textContent = '游客';
                    dropdownNickname.textContent = '游客';
                    dropdownRole.textContent = '未登录';
                    adminBtn.classList.add('hidden');
                }
            },
            
            // 修改密码
            changePassword: async (oldPassword, newPassword) => {
                if (!State.isLoggedIn) return false;
                
                // 验证密码长度
                if (newPassword.length !== 8) {
                    document.getElementById('newPwdError').classList.remove('hidden');
                    return false;
                }
                
                try {
                    // 先验证旧密码
                    await AV.User.logIn(State.currentUser.username, oldPassword);
                    
                    // 修改密码
                    const user = AV.User.current();
                    user.setPassword(newPassword);
                    await user.save();
                    
                    Utils.showSuccess('密码修改成功，请重新登录');
                    return true;
                } catch (err) {
                    console.error('修改密码失败:', err);
                    
                    if (err.message.includes('Invalid username/password')) {
                        Utils.showError('原密码错误');
                    } else {
                        Utils.showError('修改密码失败，请稍后再试');
                    }
                    
                    return false;
                }
            },
            
            // 更换头像
            changeAvatar: async (file) => {
                if (!State.isLoggedIn || !file) return false;
                
                try {
                    const user = AV.User.current();
                    const avFile = new AV.File(file.name, file);
                    await avFile.save();
                    
                    user.set('avatar', avFile.url());
                    await user.save();
                    
                    // 更新本地状态
                    State.currentUser.avatar = avFile.url();
                    
                    Auth.updateUserInfoDisplay();
                    Utils.showSuccess('头像更换成功');
                    return true;
                } catch (err) {
                    console.error('更换头像失败:', err);
                    Utils.showError('更换头像失败，请稍后再试');
                    return false;
                }
            }
        };

        // 好友相关
        const Friends = {
            // 加载好友列表
            loadFriends: async () => {
                if (!State.isLoggedIn) return;
                
                try {
                    // 模拟好友列表
                    const friendsList = document.getElementById('friendsList');
                    friendsList.innerHTML = '<p class="text-center text-gray-500 py-8">暂无好友，快去添加吧~</p>';
                } catch (err) {
                    console.error('加载好友列表失败:', err);
                    Utils.showError('加载好友列表失败');
                }
            },
            
            // 搜索用户
            searchUsers: async (keyword) => {
                if (!keyword || keyword.trim() === '') {
                    document.getElementById('searchResults').classList.add('hidden');
                    return;
                }
                
                try {
                    const query = new AV.Query(AV.User);
                    query.contains('username', keyword);
                    query.limit(5);
                    const users = await query.find();
                    
                    const resultsEl = document.getElementById('searchResults');
                    
                    if (users.length === 0) {
                        resultsEl.innerHTML = '<p class="px-4 py-3 text-gray-500">没有找到相关用户</p>';
                        resultsEl.classList.remove('hidden');
                        return;
                    }
                    
                    let html = '';
                    users.forEach(user => {
                        const userData = user.toJSON();
                        if (userData.objectId === State.currentUser.objectId) return;
                        
                        const avatarUrl = userData.avatar || `https://picsum.photos/200/200?random=${userData.objectId}`;
                        
                        html += `
                            <div class="flex items-center justify-between p-3 hover:bg-gray-50 transition-colors">
                                <div class="flex items-center">
                                    <div class="w-8 h-8 rounded-full overflow-hidden mr-3">
                                        <img src="${avatarUrl}" alt="${userData.username}" class="w-full h-full object-cover">
                                    </div>
                                    <div>
                                        <p class="font-medium text-sm">${userData.username}</p>
                                    </div>
                                </div>
                                <button class="add-friend-btn text-primary text-sm" data-username="${userData.username}">
                                    添加好友
                                </button>
                            </div>
                        `;
                    });
                    
                    resultsEl.innerHTML = html;
                    resultsEl.classList.remove('hidden');
                    
                    // 添加好友按钮事件
                    document.querySelectorAll('.add-friend-btn').forEach(btn => {
                        btn.addEventListener('click', () => {
                            const username = btn.getAttribute('data-username');
                            document.getElementById('addFriendUsername').value = username;
                            document.getElementById('searchResults').classList.add('hidden');
                            UI.showModal('addFriendModal');
                        });
                    });
                } catch (err) {
                    console.error('搜索用户失败:', err);
                    Utils.showError('搜索失败，请稍后再试');
                }
            },
            
            // 添加好友
            addFriend: async (username, message) => {
                if (!State.isLoggedIn || !username) return false;
                
                try {
                    // 查找用户
                    const query = new AV.Query(AV.User);
                    query.equalTo('username', username);
                    const users = await query.find();
                    
                    if (users.length === 0) {
                        Utils.showError('用户不存在');
                        return false;
                    }
                    
                    // 创建好友请求
                    const FriendRequest = AV.Object.extend('FriendRequest');
                    const request = new FriendRequest();
                    request.set('from', AV.User.current());
                    request.set('to', users[0]);
                    request.set('message', message || '我想加你为好友');
                    request.set('status', 'pending');
                    await request.save();
                    
                    Utils.showSuccess('好友请求已发送');
                    return true;
                } catch (err) {
                    console.error('添加好友失败:', err);
                    Utils.showError('添加好友失败，请稍后再试');
                    return false;
                }
            }
        };

        // 管理员相关
        const Admin = {
            // 加载用户列表
            loadUsers: async () => {
                if (!State.isLoggedIn || !(State.currentRole === Config.ROLES.SUPER_ADMIN || State.currentRole === Config.ROLES.ADMIN)) {
                    return;
                }
                
                try {
                    const query = new AV.Query(AV.User);
                    query.limit(20);
                    const users = await query.find();
                    
                    const tableBody = document.getElementById('usersTableBody');
                    let html = '';
                    
                    users.forEach(user => {
                        const userData = user.toJSON();
                        let roleText = '普通用户';
                        
                        if (userData.username === 'lemon') {
                            roleText = '超级管理员';
                        }
                        
                        html += `
                            <tr class="border-b border-gray-200 hover:bg-gray-50">
                                <td class="py-3 px-4">${userData.objectId}</td>
                                <td class="py-3 px-4">
                                    <div class="flex items-center">
                                        <div class="w-8 h-8 rounded-full overflow-hidden mr-2">
                                            <img src="${userData.avatar || `https://picsum.photos/200/200?random=${userData.objectId}`}" alt="${userData.username}" class="w-full h-full object-cover">
                                        </div>
                                        ${userData.username}
                                    </div>
                                </td>
                                <td class="py-3 px-4">${roleText}</td>
                                <td class="py-3 px-4">${Utils.formatDate(userData.createdAt)}</td>
                                <td class="py-3 px-4">
                                    <div class="flex space-x-2">
                                        <button class="text-primary hover:text-primary/80 transition-colors">
                                            <i class="fa fa-edit"></i>
                                        </button>
                                        <button class="text-red-500 hover:text-red-700 transition-colors ${userData.username === 'lemon' ? 'opacity-50 cursor-not-allowed' : ''}" ${userData.username === 'lemon' ? 'disabled' : ''}>
                                            <i class="fa fa-trash"></i>
                                        </button>
                                    </div>
                                </td>
                            </tr>
                        `;
                    });
                    
                    tableBody.innerHTML = html;
                    document.getElementById('totalUsers').textContent = users.length;
                } catch (err) {
                    console.error('加载用户列表失败:', err);
                    Utils.showError('加载用户列表失败');
                }
            }
        };

        // UI相关
        const UI = {
            // 显示指定内容区域
            showContent: (contentId) => {
                // 隐藏所有内容
                document.getElementById('authCard').classList.add('hidden');
                document.getElementById('homeContent').classList.add('hidden');
                document.getElementById('profileContent').classList.add('hidden');
                document.getElementById('friendsContent').classList.add('hidden');
                document.getElementById('adminContent').classList.add('hidden');
                
                // 显示指定内容
                document.getElementById(contentId).classList.remove('hidden');
                
                // 高亮当前导航
                document.querySelectorAll('.nav-btn').forEach(btn => {
                    btn.classList.remove('bg-primary/10', 'text-primary');
                    btn.classList.add('hover:bg-gray-100');
                });
                
                // 根据内容设置导航高亮
                if (contentId === 'homeContent') {
                    document.querySelectorAll('.nav-btn')[0].classList.add('bg-primary/10', 'text-primary');
                    document.querySelectorAll('.nav-btn')[0].classList.remove('hover:bg-gray-100');
                } else if (contentId === 'friendsContent') {
                    document.querySelectorAll('.nav-btn')[1].classList.add('bg-primary/10', 'text-primary');
                    document.querySelectorAll('.nav-btn')[1].classList.remove('hover:bg-gray-100');
                }
            },
            
            // 显示模态框
            showModal: (modalId) => {
                document.getElementById(modalId).classList.remove('hidden');
                // 清空错误提示
                document.querySelectorAll('.text-red-500').forEach(el => {
                    el.classList.add('hidden');
                });
                // 清空输入框
                if (modalId === 'addFriendModal') {
                    document.getElementById('addFriendMessage').value = '';
                } else if (modalId === 'changePwdModal') {
                    document.getElementById('oldPassword').value = '';
                    document.getElementById('newPassword').value = '';
                    document.getElementById('confirmPassword').value = '';
                }
            },
            
            // 隐藏模态框
            hideModal: (modalId) => {
                document.getElementById(modalId).classList.add('hidden');
            }
        };

        // 事件监听 - 确保所有交互正常
        document.addEventListener('DOMContentLoaded', () => {
            // 初始化
            Auth.init();
            
            // 登录/注册切换
            document.getElementById('showRegisterBtn').addEventListener('click', () => {
                document.getElementById('loginForm').classList.add('hidden');
                document.getElementById('registerForm').classList.remove('hidden');
            });
            
            document.getElementById('showLoginBtn').addEventListener('click', () => {
                document.getElementById('registerForm').classList.add('hidden');
                document.getElementById('loginForm').classList.remove('hidden');
            });
            
            // 登录按钮
            document.getElementById('loginBtn').addEventListener('click', async () => {
                const username = document.getElementById('loginUsername').value.trim();
                const password = document.getElementById('loginPassword').value;
                
                if (!username || !password) {
                    Utils.showError('请输入用户名和密码');
                    return;
                }
                
                const success = await Auth.login(username, password);
                if (success) {
                    UI.showContent('homeContent');
                }
            });
            
            // 注册按钮
            document.getElementById('registerBtn').addEventListener('click', async () => {
                const username = document.getElementById('regUsername').value.trim();
                const password = document.getElementById('regPassword').value;
                
                if (!username || !password) {
                    Utils.showError('请输入用户名和密码');
                    return;
                }
                
                const success = await Auth.register(username, password);
                if (success) {
                    document.getElementById('registerForm').classList.add('hidden');
                    document.getElementById('loginForm').classList.remove('hidden');
                }
            });
            
            // 退出登录
            document.getElementById('logoutBtn').addEventListener('click', () => {
                Auth.logout();
            });
            
            // 用户菜单切换
            document.getElementById('userAvatarBtn').addEventListener('click', () => {
                document.getElementById('avatarDropdown').classList.toggle('hidden');
            });
            
            // 点击其他地方关闭下拉菜单
            document.addEventListener('click', (e) => {
                const userMenu = document.getElementById('userMenu');
                if (!userMenu.contains(e.target)) {
                    document.getElementById('avatarDropdown').classList.add('hidden');
                }
            });
            
            // 导航按钮
            document.querySelectorAll('.nav-btn')[0].addEventListener('click', () => {
                if (State.isLoggedIn) {
                    UI.showContent('homeContent');
                } else {
                    UI.showContent('authCard');
                }
            });
            
            document.querySelectorAll('.nav-btn')[1].addEventListener('click', () => {
                if (State.isLoggedIn) {
                    UI.showContent('friendsContent');
                } else {
                    Utils.showError('请先登录');
                }
            });
            
            // 个人中心
            document.getElementById('profileBtn').addEventListener('click', () => {
                if (State.isLoggedIn) {
                    UI.showContent('profileContent');
                    document.getElementById('avatarDropdown').classList.add('hidden');
                }
            });
            
            // 管理中心
            document.getElementById('adminBtn').addEventListener('click', () => {
                if (State.isLoggedIn && (State.currentRole === Config.ROLES.SUPER_ADMIN || State.currentRole === Config.ROLES.ADMIN)) {
                    UI.showContent('adminContent');
                    document.getElementById('avatarDropdown').classList.add('hidden');
                }
            });
            
            // 好友页面
            document.getElementById('toFriendsBtn').addEventListener('click', () => {
                if (State.isLoggedIn) {
                    UI.showContent('friendsContent');
                } else {
                    Utils.showError('请先登录');
                }
            });
            
            // 添加好友
            document.getElementById('addFriendBtn').addEventListener('click', () => {
                UI.showModal('addFriendModal');
            });
            
            document.getElementById('closeAddFriendModal').addEventListener('click', () => {
                UI.hideModal('addFriendModal');
            });
            
            document.getElementById('confirmAddFriendBtn').addEventListener('click', async () => {
                const username = document.getElementById('addFriendUsername').value.trim();
                const message = document.getElementById('addFriendMessage').value.trim();
                
                if (!username) {
                    Utils.showError('请输入好友昵称');
                    return;
                }
                
                const success = await Friends.addFriend(username, message);
                if (success) {
                    UI.hideModal('addFriendModal');
                }
            });
            
            // 修改密码
            document.getElementById('changePwdBtn').addEventListener('click', () => {
                UI.showModal('changePwdModal');
            });
            
            document.getElementById('closeChangePwdModal').addEventListener('click', () => {
                UI.hideModal('changePwdModal');
            });
            
            document.getElementById('confirmChangePwdBtn').addEventListener('click', async () => {
                const oldPassword = document.getElementById('oldPassword').value;
                const newPassword = document.getElementById('newPassword').value;
                const confirmPassword = document.getElementById('confirmPassword').value;
                
                // 验证
                let isValid = true;
                
                if (newPassword.length !== 8) {
                    document.getElementById('newPwdError').classList.remove('hidden');
                    isValid = false;
                } else {
                    document.getElementById('newPwdError').classList.add('hidden');
                }
                
                if (newPassword !== confirmPassword) {
                    document.getElementById('confirmPwdError').classList.remove('hidden');
                    isValid = false;
                } else {
                    document.getElementById('confirmPwdError').classList.add('hidden');
                }
                
                if (!isValid) return;
                
                const success = await Auth.changePassword(oldPassword, newPassword);
                if (success) {
                    UI.hideModal('changePwdModal');
                    Auth.logout();
                }
            });
            
            // 更换头像
            document.getElementById('changeAvatarBtn').addEventListener('click', () => {
                document.getElementById('avatarInput').click();
            });
            
            document.getElementById('avatarInput').addEventListener('change', async (e) => {
                const file = e.target.files[0];
                if (file) {
                    await Auth.changeAvatar(file);
                    e.target.value = ''; // 重置input
                }
            });
            
            // 密码长度验证
            document.getElementById('loginPassword').addEventListener('input', (e) => {
                if (e.target.value.length !== 8) {
                    document.getElementById('passwordError').classList.remove('hidden');
                } else {
                    document.getElementById('passwordError').classList.add('hidden');
                }
            });
            
            document.getElementById('regPassword').addEventListener('input', (e) => {
                if (e.target.value.length !== 8) {
                    document.getElementById('regPasswordError').classList.remove('hidden');
                } else {
                    document.getElementById('regPasswordError').classList.add('hidden');
                }
            });
            
            document.getElementById('newPassword').addEventListener('input', (e) => {
                if (e.target.value.length !== 8) {
                    document.getElementById('newPwdError').classList.remove('hidden');
                } else {
                    document.getElementById('newPwdError').classList.add('hidden');
                }
                
                // 检查两次输入是否一致
                if (e.target.value !== document.getElementById('confirmPassword').value) {
                    document.getElementById('confirmPwdError').classList.remove('hidden');
                } else {
                    document.getElementById('confirmPwdError').classList.add('hidden');
                }
            });
            
            document.getElementById('confirmPassword').addEventListener('input', (e) => {
                if (e.target.value !== document.getElementById('newPassword').value) {
                    document.getElementById('confirmPwdError').classList.remove('hidden');
                } else {
                    document.getElementById('confirmPwdError').classList.add('hidden');
                }
            });
            
            // 密码显示/隐藏切换
            document.querySelectorAll('.toggle-password').forEach(btn => {
                btn.addEventListener('click', function() {
                    const icon = this.querySelector('i');
                    const input = this.parentElement.querySelector('input');
                    
                    if (input.type === 'password') {
                        input.type = 'text';
                        icon.classList.remove('fa-eye');
                        icon.classList.add('fa-eye-slash');
                    } else {
                        input.type = 'password';
                        icon.classList.remove('fa-eye-slash');
                        icon.classList.add('fa-eye');
                    }
                });
            });
            
            // 移动端搜索切换
            document.getElementById('mobileSearchBtn').addEventListener('click', () => {
                document.getElementById('mobileSearch').classList.toggle('hidden');
            });
            
            // 好友搜索
            document.getElementById('friendSearch').addEventListener('input', (e) => {
                Friends.searchUsers(e.target.value.trim());
            });
            
            // 点击其他地方关闭搜索结果
            document.addEventListener('click', (e) => {
                const searchContainer = document.querySelector('#friendSearch').parentElement;
                if (!searchContainer.contains(e.target)) {
                    document.getElementById('searchResults').classList.add('hidden');
                }
            });
        });
    </script>
</body>
</html>
    
