<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>æ ¡å›­ç®¡ç†ç³»ç»Ÿ</title>
  <!-- å¼•å…¥å¤–éƒ¨èµ„æº -->
  <script src="https://cdn.jsdelivr.net/npm/leancloud-storage@4.12.0/dist/av-min.js"></script>
  
  <!-- å¼•å…¥CSSæ ·å¼ -->
  <style>
    /* åŸºç¡€æ ·å¼ */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }
    
    body {
      display: flex;
      flex-direction: column;
      min-height: 100vh;
    }
    
    .navbar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 1rem 2rem;
      background-color: var(--primary-color);
      color: white;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    
    .logo {
      font-size: 1.5rem;
      font-weight: bold;
    }
    
    .search-box {
      display: flex;
      flex: 0 0 30%;
      margin: 0 1rem;
    }
    
    .search-box input {
      flex: 1;
      padding: 0.5rem;
      border: none;
      border-radius: 4px 0 0 4px;
      outline: none;
    }
    
    .search-box button {
      padding: 0 1rem;
      background-color: var(--btn-hover);
      border: none;
      border-radius: 0 4px 4px 0;
      color: white;
      cursor: pointer;
    }
    
    .user-info {
      display: flex;
      align-items: center;
    }
    
    .sidebar {
      width: 220px;
      background-color: var(--card-bg);
      border-right: 1px solid var(--border-color);
      height: calc(100vh - 64px);
      position: fixed;
      overflow-y: auto;
    }
    
    .menu-list {
      list-style: none;
    }
    
    .menu-item {
      display: block;
      padding: 1rem 1.5rem;
      color: var(--text-color);
      text-decoration: none;
      border-bottom: 1px solid var(--border-color);
      transition: background-color 0.2s;
    }
    
    .menu-item:hover, .menu-item.active {
      background-color: rgba(0,0,0,0.05);
      font-weight: 500;
    }
    
    .content {
      flex: 1;
      margin-left: 220px;
      padding: 2rem;
      min-height: calc(100vh - 64px);
    }
    
    .page {
      display: none;
      animation: fadeIn 0.3s ease-in-out;
    }
    
    .page.active {
      display: block;
    }
    
    .footer {
      text-align: center;
      padding: 1rem;
      border-top: 1px solid var(--border-color);
      margin-left: 220px;
    }
    
    .card {
      background-color: var(--card-bg);
      border-radius: 8px;
      padding: 1.5rem;
      margin-bottom: 1.5rem;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }
    
    .feature-cards {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 1.5rem;
      margin-top: 2rem;
    }
    
    .btn {
      background-color: var(--primary-color);
      color: white;
      border: none;
      padding: 0.5rem 1rem;
      border-radius: 4px;
      cursor: pointer;
      transition: all 0.2s;
      font-size: 0.9rem;
    }
    
    .btn:hover {
      background-color: var(--btn-hover);
      transform: translateY(-2px);
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    
    .form-group {
      margin-bottom: 1rem;
    }
    
    label {
      display: block;
      margin-bottom: 0.5rem;
      font-weight: 500;
    }
    
    input, textarea, select {
      width: 100%;
      padding: 0.5rem;
      border: 1px solid var(--border-color);
      border-radius: 4px;
      background-color: var(--bg-color);
      color: var(--text-color);
    }
    
    .stats-cards {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: 1rem;
      margin-bottom: 2rem;
    }
    
    .stat-card {
      background-color: var(--card-bg);
      border-radius: 8px;
      padding: 1rem;
      text-align: center;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }
    
    .stat-card h3 {
      color: var(--text-color);
      margin-bottom: 0.5rem;
      font-size: 1rem;
    }
    
    .stat-card p {
      font-size: 1.8rem;
      font-weight: bold;
      color: var(--primary-color);
    }
    
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 1rem;
    }
    
    th, td {
      padding: 0.8rem;
      text-align: left;
      border-bottom: 1px solid var(--border-color);
    }
    
    th {
      background-color: rgba(0,0,0,0.05);
      font-weight: 500;
    }
    
    .actions {
      display: flex;
      gap: 0.5rem;
    }
    
    .error {
      color: #ff4d4f;
      margin: 0.5rem 0;
    }
    
    .admin-section {
      margin-bottom: 2rem;
    }
    
    .online-status {
      display: inline-block;
      width: 8px;
      height: 8px;
      border-radius: 50%;
      margin-right: 4px;
    }
    
    .online-status.online {
      background-color: #52C41A;
    }
    
    .online-status.offline {
      background-color: #9CA3AF;
    }
    
    .role-super {
      color: #FF4D4F;
      font-weight: bold;
      margin-left: 4px;
    }
    
    .role-admin {
      color: #165DFF;
      font-weight: bold;
      margin-left: 4px;
    }
    
    .theme-selector {
      display: flex;
      gap: 1rem;
      margin: 1rem 0;
    }
    
    .theme-option {
      width: 80px;
      height: 80px;
      border-radius: 8px;
      cursor: pointer;
      border: 2px solid transparent;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.8rem;
    }
    
    .theme-option.selected {
      border-color: var(--primary-color);
    }
    
    .schedule-item, .resource-item, .qa-item {
      background-color: var(--card-bg);
      border-radius: 8px;
      padding: 1rem;
      margin-bottom: 1rem;
      border-left: 4px solid var(--primary-color);
    }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    /* å“åº”å¼è®¾è®¡ */
    @media (max-width: 768px) {
      .sidebar {
        width: 100%;
        height: auto;
        position: relative;
      }
      
      .content, .footer {
        margin-left: 0;
      }
      
      .search-box {
        flex: none;
        width: 100%;
        margin: 1rem 0;
      }
      
      .navbar {
        flex-direction: column;
        align-items: stretch;
      }
      
      .feature-cards, .stats-cards {
        grid-template-columns: 1fr;
      }
    }
  </style>
  
  <!-- ä¸»é¢˜æ ·å¼ -->
  <style>
    /* ä¸»é¢˜å˜é‡å®šä¹‰ */
    :root {
      --bg-color: #FFFFFF;
      --text-color: #333333;
      --card-bg: #F5F7FA;
      --primary-color: #165DFF;
      --btn-hover: #0E4CD1;
      --border-color: #E5E7EB;
    }
    
    /* æš—é»‘ä¸»é¢˜ */
    :root.dark-theme {
      --bg-color: #1E293B;
      --text-color: #E2E8F0;
      --card-bg: #334155;
      --primary-color: #0F172A;
      --btn-hover: #1E40AF;
      --border-color: #475569;
    }
    
    /* æ ¡å›­ä¸»é¢˜ */
    :root.campus-theme {
      --bg-color: #FFFBEB;
      --text-color: #1F2937;
      --card-bg: #D1FAE5;
      --primary-color: #36D399;
      --btn-hover: #10B981;
      --border-color: #A7F3D0;
      --accent-color: #FBBF24;
    }
  </style>
</head>
<body>
  <!-- é¡¶éƒ¨å¯¼èˆªæ  -->
  <header class="navbar">
    <div class="logo">æ ¡å›­ç®¡ç†ç³»ç»Ÿ</div>
    <div class="search-box">
      <input type="text" placeholder="æœç´¢..." id="globalSearch">
      <button onclick="searchHandler()">æœç´¢</button>
    </div>
    <div class="user-info" id="userInfo">
      <span class="online-status offline"></span>
      <span class="username">æœªç™»å½•</span>
      <button class="btn" style="margin-left: 10px;" id="loginBtn">ç™»å½•</button>
    </div>
  </header>

  <!-- ä¾§è¾¹æ èœå• -->
  <aside class="sidebar">
    <ul class="menu-list">
      <li><a href="#home" class="menu-item active" onclick="switchPage('homePage')">é¦–é¡µ</a></li>
      <li><a href="#userApplication" class="menu-item" onclick="switchPage('userApplicationPage')">è´¦å·ç”³è¯·</a></li>
      <li><a href="#passwordReset" class="menu-item" onclick="switchPage('passwordResetPage')">å¯†ç é‡ç½®</a></li>
      <li><a href="#announcement" class="menu-item" onclick="switchPage('announcementPage')">å…¬å‘Š</a></li>
      <li><a href="#message" class="menu-item" onclick="switchPage('messagePage')">èŠå¤©æ¶ˆæ¯</a></li>
      <li><a href="#suggestion" class="menu-item" onclick="switchPage('suggestionPage')">å»ºè®®åé¦ˆ</a></li>
      <!-- æ ¡å›­ç‰¹è‰²åŠŸèƒ½ -->
      <li><a href="#schedule" class="menu-item" onclick="switchPage('schedulePage')">æ ¡å›­æ—¥ç¨‹</a></li>
      <li><a href="#resources" class="menu-item" onclick="switchPage('resourcesPage')">å­¦ä¹ èµ„æº</a></li>
      <li><a href="#qa" class="menu-item" onclick="switchPage('qaPage')">äº’åŠ©é—®ç­”</a></li>
      <!-- ç®¡ç†ä¸­å¿ƒï¼ˆæƒé™æ§åˆ¶æ˜¾ç¤ºï¼‰ -->
      <li><a href="#adminCenter" class="menu-item admin-only" onclick="switchPage('adminCenterPage')">ç®¡ç†ä¸­å¿ƒ</a></li>
      <!-- ä¸ªäººä¸­å¿ƒ -->
      <li><a href="#profile" class="menu-item" onclick="switchPage('profilePage')">ä¸ªäººä¸­å¿ƒ</a></li>
    </ul>
  </aside>

  <!-- ä¸»å†…å®¹åŒº -->
  <main class="content" id="mainContent">
    <!-- é¦–é¡µå†…å®¹ -->
    <div class="page active" id="homePage">
      <h1>æ¬¢è¿ä½¿ç”¨æ ¡å›­ç®¡ç†ç³»ç»Ÿ</h1>
      <div class="feature-cards">
        <div class="card">
          <h3>è´¦å·ç®¡ç†</h3>
          <p>ç”³è¯·è´¦å·ã€é‡ç½®å¯†ç ã€ç®¡ç†ç”¨æˆ·</p>
          <button class="btn" onclick="switchPage('userApplicationPage')">è¿›å…¥</button>
        </div>
        <div class="card">
          <h3>æ ¡å›­å·¥å…·</h3>
          <p>æ—¥ç¨‹å®‰æ’ã€å­¦ä¹ èµ„æºã€äº’åŠ©é—®ç­”</p>
          <button class="btn" onclick="switchPage('schedulePage')">è¿›å…¥</button>
        </div>
        <div class="card">
          <h3>ç³»ç»Ÿè®¾ç½®</h3>
          <p>ä¸»é¢˜åˆ‡æ¢ã€æ•°æ®å¤‡ä»½</p>
          <button class="btn" onclick="switchPage('profilePage')">è¿›å…¥</button>
        </div>
      </div>
    </div>

    <!-- è´¦å·ç”³è¯·é¡µ -->
    <div class="page" id="userApplicationPage">
      <h1>è´¦å·ç”³è¯·</h1>
      <div class="card">
        <form id="applicationForm">
          <div class="form-group">
            <label for="appUsername">ç”¨æˆ·å</label>
            <input type="text" id="appUsername" required>
          </div>
          <div class="form-group">
            <label for="appPhone">æ‰‹æœºå·</label>
            <input type="text" id="appPhone" required>
          </div>
          <div class="form-group">
            <label for="appReason">ç”³è¯·ç†ç”±</label>
            <textarea id="appReason" rows="3" required></textarea>
          </div>
          <div id="applicationErrors"></div>
          <button type="button" class="btn" onclick="submitApplication()">æäº¤ç”³è¯·</button>
        </form>
      </div>
    </div>

    <!-- å¯†ç é‡ç½®é¡µ -->
    <div class="page" id="passwordResetPage">
      <h1>å¯†ç é‡ç½®</h1>
      <div class="card">
        <p>è¯·è¾“å…¥æ‚¨çš„ç”¨æˆ·åï¼Œæˆ‘ä»¬å°†å¤„ç†æ‚¨çš„å¯†ç é‡ç½®ç”³è¯·</p>
        <div class="form-group">
          <label for="resetUsername">ç”¨æˆ·å</label>
          <input type="text" id="resetUsername" required>
        </div>
        <button class="btn" onclick="submitPasswordReset()">æäº¤ç”³è¯·</button>
      </div>
    </div>

    <!-- å…¬å‘Šé¡µ -->
    <div class="page" id="announcementPage">
      <h1>å…¬å‘Š</h1>
      <div class="card admin-only">
        <h3>å‘å¸ƒæ–°å…¬å‘Š</h3>
        <div class="form-group">
          <label for="annTitle">æ ‡é¢˜</label>
          <input type="text" id="annTitle">
        </div>
        <div class="form-group">
          <label for="annContent">å†…å®¹</label>
          <textarea id="annContent" rows="3"></textarea>
        </div>
        <button class="btn" onclick="publishAnnouncement()">å‘å¸ƒ</button>
      </div>
      
      <div id="announcementList">
        <!-- å…¬å‘Šåˆ—è¡¨å°†é€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
      </div>
    </div>

    <!-- èŠå¤©æ¶ˆæ¯é¡µ -->
    <div class="page" id="messagePage">
      <h1>èŠå¤©æ¶ˆæ¯</h1>
      <div class="card" style="height: 400px; display: flex; flex-direction: column;">
        <div id="messageList" style="flex: 1; overflow-y: auto; margin-bottom: 1rem;">
          <!-- æ¶ˆæ¯åˆ—è¡¨å°†é€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
        </div>
        <div style="display: flex;">
          <input type="text" id="messageContent" placeholder="è¾“å…¥æ¶ˆæ¯..." style="margin-right: 0.5rem;">
          <button class="btn" onclick="sendMessage()">å‘é€</button>
        </div>
      </div>
    </div>

    <!-- å»ºè®®åé¦ˆé¡µ -->
    <div class="page" id="suggestionPage">
      <h1>å»ºè®®åé¦ˆ</h1>
      <div class="card">
        <div class="form-group">
          <label for="suggestionContent">æ‚¨çš„å»ºè®®</label>
          <textarea id="suggestionContent" rows="3"></textarea>
        </div>
        <button class="btn" onclick="submitSuggestion()">æäº¤å»ºè®®</button>
      </div>
      
      <div id="mySuggestions">
        <!-- æˆ‘çš„å»ºè®®å°†é€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
      </div>
    </div>

    <!-- æ ¡å›­æ—¥ç¨‹é¡µ -->
    <div class="page" id="schedulePage">
      <h1>æ ¡å›­æ—¥ç¨‹</h1>
      <button class="btn" onclick="showAddScheduleForm()">æ·»åŠ æ—¥ç¨‹</button>
      
      <div id="scheduleForm" style="display: none; margin: 1rem 0;" class="card">
        <div class="form-group">
          <label for="scheduleTitle">æ ‡é¢˜</label>
          <input type="text" id="scheduleTitle">
        </div>
        <div class="form-group">
          <label for="scheduleTime">æ—¶é—´</label>
          <input type="text" id="scheduleTime" placeholder="æ ¼å¼ï¼š2024-05-20 08:00">
        </div>
        <div class="form-group">
          <label for="scheduleLocation">åœ°ç‚¹</label>
          <input type="text" id="scheduleLocation">
        </div>
        <div id="scheduleErrors"></div>
        <button class="btn" onclick="addSchedule()">ä¿å­˜</button>
        <button class="btn" style="background-color: #9CA3AF;" onclick="hideAddScheduleForm()">å–æ¶ˆ</button>
      </div>
      
      <div id="scheduleList">
        <!-- æ—¥ç¨‹åˆ—è¡¨å°†é€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
      </div>
    </div>

    <!-- å­¦ä¹ èµ„æºé¡µ -->
    <div class="page" id="resourcesPage">
      <h1>å­¦ä¹ èµ„æº</h1>
      <button class="btn" onclick="showAddResourceForm()">ä¸Šä¼ èµ„æº</button>
      
      <div id="resourceForm" style="display: none; margin: 1rem 0;" class="card">
        <div class="form-group">
          <label for="resourceName">èµ„æºåç§°</label>
          <input type="text" id="resourceName">
        </div>
        <div class="form-group">
          <label for="resourceCategory">åˆ†ç±»</label>
          <select id="resourceCategory">
            <option value="è¯¾ä»¶">è¯¾ä»¶</option>
            <option value="ä¹ é¢˜">ä¹ é¢˜</option>
            <option value="ç¬”è®°">ç¬”è®°</option>
            <option value="å…¶ä»–">å…¶ä»–</option>
          </select>
        </div>
        <div class="form-group">
          <label for="resourceUrl">èµ„æºé“¾æ¥</label>
          <input type="text" id="resourceUrl" placeholder="è¾“å…¥èµ„æºä¸‹è½½é“¾æ¥">
        </div>
        <button class="btn" onclick="addResource()">ä¿å­˜</button>
        <button class="btn" style="background-color: #9CA3AF;" onclick="hideAddResourceForm()">å–æ¶ˆ</button>
      </div>
      
      <div id="resourcesList">
        <!-- èµ„æºåˆ—è¡¨å°†é€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
      </div>
    </div>

    <!-- äº’åŠ©é—®ç­”é¡µ -->
    <div class="page" id="qaPage">
      <h1>äº’åŠ©é—®ç­”</h1>
      <button class="btn" onclick="showAddQuestionForm()">æé—®</button>
      
      <div id="questionForm" style="display: none; margin: 1rem 0;" class="card">
        <div class="form-group">
          <label for="questionTitle">é—®é¢˜æ ‡é¢˜</label>
          <input type="text" id="questionTitle">
        </div>
        <div class="form-group">
          <label for="questionContent">é—®é¢˜å†…å®¹</label>
          <textarea id="questionContent" rows="3"></textarea>
        </div>
        <div class="form-group">
          <label for="questionTags">æ ‡ç­¾ï¼ˆç”¨é€—å·åˆ†éš”ï¼‰</label>
          <input type="text" id="questionTags" placeholder="å¦‚ï¼šå­¦ä¹ ,é«˜æ•°">
        </div>
        <button class="btn" onclick="addQuestion()">å‘å¸ƒé—®é¢˜</button>
        <button class="btn" style="background-color: #9CA3AF;" onclick="hideAddQuestionForm()">å–æ¶ˆ</button>
      </div>
      
      <div id="qaList">
        <!-- é—®ç­”åˆ—è¡¨å°†é€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
      </div>
    </div>

    <!-- ç®¡ç†ä¸­å¿ƒé¡µé¢ -->
    <div class="page" id="adminCenterPage">
      <h1>ç®¡ç†ä¸­å¿ƒ</h1>
      
      <!-- æ•°æ®æ¦‚è§ˆ -->
      <div class="stats-cards">
        <div class="stat-card">
          <h3>å¾…å¤„ç†ç”³è¯·</h3>
          <p id="pendingApplications">0</p>
        </div>
        <div class="stat-card">
          <h3>ç”¨æˆ·æ€»æ•°</h3>
          <p id="totalUsers">0</p>
        </div>
        <div class="stat-card">
          <h3>å…¬å‘Šæ€»æ•°</h3>
          <p id="totalAnnouncements">0</p>
        </div>
      </div>

      <!-- ç”¨æˆ·ç®¡ç† -->
      <div class="admin-section">
        <h2>ç”¨æˆ·ç®¡ç†</h2>
        <input type="text" placeholder="æœç´¢ç”¨æˆ·å..." id="userSearch">
        <table class="user-table">
          <thead>
            <tr>
              <th>åœ¨çº¿çŠ¶æ€</th>
              <th>ç”¨æˆ·å</th>
              <th>è§’è‰²</th>
              <th>æ³¨å†Œæ—¶é—´</th>
              <th>æ“ä½œ</th>
            </tr>
          </thead>
          <tbody id="userTableBody">
            <!-- JSåŠ¨æ€ç”Ÿæˆç”¨æˆ·åˆ—è¡¨ -->
          </tbody>
        </table>
      </div>
      
      <!-- ç”³è¯·ç®¡ç† -->
      <div class="admin-section">
        <h2>è´¦å·ç”³è¯·ç®¡ç†</h2>
        <table class="user-table">
          <thead>
            <tr>
              <th>ç”¨æˆ·å</th>
              <th>æ‰‹æœºå·</th>
              <th>ç”³è¯·ç†ç”±</th>
              <th>ç”³è¯·æ—¶é—´</th>
              <th>æ“ä½œ</th>
            </tr>
          </thead>
          <tbody id="applicationTableBody">
            <!-- JSåŠ¨æ€ç”Ÿæˆç”³è¯·åˆ—è¡¨ -->
          </tbody>
        </table>
      </div>
    </div>

    <!-- ä¸ªäººä¸­å¿ƒé¡µ -->
    <div class="page" id="profilePage">
      <h1>ä¸ªäººä¸­å¿ƒ</h1>
      
      <div class="card">
        <h3>ä¸ªäººä¿¡æ¯</h3>
        <div id="profileInfo">
          <!-- ä¸ªäººä¿¡æ¯å°†é€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
        </div>
      </div>
      
      <div class="card">
        <h3>ä¸»é¢˜è®¾ç½®</h3>
        <div class="theme-selector">
          <div class="theme-option selected" id="theme-default" style="background-color: #FFFFFF; color: #333333;" onclick="switchTheme('default')">é»˜è®¤</div>
          <div class="theme-option" id="theme-dark" style="background-color: #1E293B; color: #E2E8F0;" onclick="switchTheme('dark')">æš—é»‘</div>
          <div class="theme-option" id="theme-campus" style="background-color: #FFFBEB; color: #1F2937;" onclick="switchTheme('campus')">æ ¡å›­</div>
        </div>
      </div>
      
      <div class="card">
        <h3>æ•°æ®å¤‡ä»½</h3>
        <button class="btn" onclick="Backup.export()">å¯¼å‡ºæ•°æ®</button>
        <input type="file" id="importFile" accept=".json" style="display: none;" onchange="Backup.import(this.files[0])">
        <button class="btn" style="margin-left: 10px;" onclick="document.getElementById('importFile').click()">å¯¼å…¥æ•°æ®</button>
      </div>
    </div>
  </main>

  <!-- åº•éƒ¨ -->
  <footer class="footer">
    <p>Â© 2024 æ ¡å›­ç®¡ç†ç³»ç»Ÿ</p>
  </footer>

  <!-- ç™»å½•æ¨¡æ€æ¡† -->
  <div id="loginModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5); z-index: 1000; align-items: center; justify-content: center;">
    <div style="background-color: var(--bg-color); padding: 2rem; border-radius: 8px; width: 300px;">
      <h2>ç™»å½•</h2>
      <div class="form-group">
        <label for="loginUsername">ç”¨æˆ·å</label>
        <input type="text" id="loginUsername">
      </div>
      <div class="form-group">
        <label for="loginPassword">å¯†ç </label>
        <input type="password" id="loginPassword">
      </div>
      <div id="loginError" class="error"></div>
      <button class="btn" onclick="login()">ç™»å½•</button>
      <button class="btn" style="background-color: #9CA3AF; margin-left: 10px;" onclick="document.getElementById('loginModal').style.display = 'none'">å–æ¶ˆ</button>
    </div>
  </div>

  <!-- JavaScript ä»£ç  -->
  <script>
    // é…ç½®ä¿¡æ¯
    const Config = {
      leanCloudConfig: {
        appId: '30kUc571qTv0YSCTWVGRbAxk-gzGzoHsz',
        appKey: 'LxFqgqjRZ3SaRGYUGznRiWAr',
        masterKey: 'lMfqmBOj54N0r8hLynl1ZSUv',
        serverUrl: 'https://30kuc571.lc-cn-n1-shared.com'
      },
      ROLES: {
        SUPER_ADMIN: 'super_admin',
        ADMIN: 'admin',
        USER: 'user'
      },
      PAGES: {
        HOME: 'homePage',
        USER_APPLICATION: 'userApplicationPage',
        PASSWORD_RESET: 'passwordResetPage',
        ANNOUNCEMENT: 'announcementPage',
        MESSAGE: 'messagePage',
        SUGGESTION: 'suggestionPage',
        SCHEDULE: 'schedulePage',
        RESOURCES: 'resourcesPage',
        QA: 'qaPage',
        ADMIN_CENTER: 'adminCenterPage',
        PROFILE: 'profilePage'
      }
    };

    // åˆå§‹åŒ–LeanCloud
    function initLeanCloud() {
      if (window.AV) {
        AV.init({
          appId: Config.leanCloudConfig.appId,
          appKey: Config.leanCloudConfig.appKey,
          serverURL: Config.leanCloudConfig.serverUrl
        });
        console.log('LeanCloudåˆå§‹åŒ–æˆåŠŸ');
      } else {
        console.error('è¯·å¼•å…¥LeanCloud SDK');
      }
    }

    // æƒé™ä¸ç™»å½•ç®¡ç†
    const Auth = {
      currentUser: null,
      currentRole: null,

      init() {
        // æ£€æŸ¥æœ¬åœ°å­˜å‚¨çš„ç”¨æˆ·ä¿¡æ¯
        const savedUser = localStorage.getItem('currentUser');
        if (savedUser) {
          this.currentUser = JSON.parse(savedUser);
          this.updateUserInfoDisplay();
          this.checkUserRole();
          this.updateMenuPermissions();
        }
        
        // ç»‘å®šç™»å½•æŒ‰é’®äº‹ä»¶
        document.getElementById('loginBtn').addEventListener('click', () => {
          document.getElementById('loginModal').style.display = 'flex';
        });
      },

      async login(username, password) {
        try {
          const user = await AV.User.logIn(username, password);
          this.currentUser = user.toJSON();
          localStorage.setItem('currentUser', JSON.stringify(this.currentUser));
          this.updateUserInfoDisplay();
          await this.checkUserRole();
          this.updateMenuPermissions();
          document.getElementById('loginModal').style.display = 'none';
          return { success: true };
        } catch (err) {
          return { success: false, message: err.message };
        }
      },

      logout() {
        AV.User.logOut();
        this.currentUser = null;
        this.currentRole = null;
        localStorage.removeItem('currentUser');
        this.updateUserInfoDisplay();
        this.updateMenuPermissions();
      },

      async checkUserRole() {
        if (!this.currentUser) return;
        
        const user = AV.Object.createWithoutData('_User', this.currentUser.objectId);
        const query = new AV.Query('_Role');
        query.equalTo('users', user);
        
        try {
          const roles = await query.find();
          if (roles.length > 0) {
            this.currentRole = roles[0].get('name');
          } else {
            this.currentRole = Config.ROLES.USER;
          }
        } catch (err) {
          console.error('è·å–ç”¨æˆ·è§’è‰²å¤±è´¥:', err);
          this.currentRole = Config.ROLES.USER;
        }
      },

      updateUserInfoDisplay() {
        const userInfo = document.getElementById('userInfo');
        const loginBtn = document.getElementById('loginBtn');
        const usernameEl = userInfo.querySelector('.username');
        const statusEl = userInfo.querySelector('.online-status');
        
        if (this.currentUser) {
          usernameEl.textContent = this.currentUser.username;
          statusEl.className = 'online-status online';
          loginBtn.textContent = 'é€€å‡º';
          loginBtn.onclick = () => this.logout();
        } else {
          usernameEl.textContent = 'æœªç™»å½•';
          statusEl.className = 'online-status offline';
          loginBtn.textContent = 'ç™»å½•';
          loginBtn.onclick = () => {
            document.getElementById('loginModal').style.display = 'flex';
          };
        }
      },

      updateMenuPermissions() {
        const adminItems = document.querySelectorAll('.admin-only');
        adminItems.forEach(item => {
          item.style.display = this.hasAdminPermission() ? 'block' : 'none';
        });
      },

      hasAdminPermission() {
        return this.currentRole === Config.ROLES.SUPER_ADMIN || this.currentRole === Config.ROLES.ADMIN;
      },

      isSuperAdmin() {
        return this.currentRole === Config.ROLES.SUPER_ADMIN;
      },

      getCurrentUserId() {
        return this.currentUser ? this.currentUser.objectId : null;
      },

      getCurrentUsername() {
        return this.currentUser ? this.currentUser.username : 'åŒ¿å';
      }
    };

    // ä¸»é¢˜åˆ‡æ¢
    function switchTheme(themeName) {
      const root = document.documentElement;
      // ç§»é™¤æ‰€æœ‰ä¸»é¢˜ç±»
      root.classList.remove('dark-theme', 'campus-theme');
      // åº”ç”¨é€‰ä¸­ä¸»é¢˜
      if (themeName === 'dark') {
        root.classList.add('dark-theme');
      } else if (themeName === 'campus') {
        root.classList.add('campus-theme');
      }
      // æ›´æ–°ä¸»é¢˜é€‰æ‹©å™¨çš„é€‰ä¸­çŠ¶æ€
      document.querySelectorAll('.theme-option').forEach(option => {
        option.classList.remove('selected');
      });
      document.getElementById(`theme-${themeName}`).classList.add('selected');
      // ä¿å­˜åˆ°æœ¬åœ°
      localStorage.setItem('selectedTheme', themeName);
    }

    // é¡µé¢åˆ‡æ¢
    function switchPage(pageId) {
      // éšè—æ‰€æœ‰é¡µé¢
      document.querySelectorAll('.page').forEach(page => {
        page.classList.remove('active');
      });
      // æ˜¾ç¤ºé€‰ä¸­é¡µé¢
      document.getElementById(pageId).classList.add('active');
      // æ›´æ–°èœå•é€‰ä¸­çŠ¶æ€
      document.querySelectorAll('.menu-item').forEach(item => {
        item.classList.remove('active');
      });
      document.querySelector(`.menu-item[onclick="switchPage('${pageId}')"]`).classList.add('active');
      
      // ç‰¹å®šé¡µé¢åŠ è½½æ•°æ®
      if (pageId === 'schedulePage') {
        Schedule.load();
      } else if (pageId === 'resourcesPage') {
        Resources.load();
      } else if (pageId === 'qaPage') {
        QA.load();
      } else if (pageId === 'adminCenterPage') {
        Admin.loadUserList();
        Admin.loadApplications();
      } else if (pageId === 'profilePage') {
        Profile.load();
      }
    }

    // æœç´¢å¤„ç†
    function searchHandler() {
      const keyword = document.getElementById('globalSearch').value.trim();
      if (!keyword) return;
      
      // å…ˆæœç´¢æœ¬åœ°æ•°æ®
      const localResults = searchLocalData(keyword);
      if (localResults.length > 0) {
        alert(`æ‰¾åˆ°${localResults.length}æ¡æœ¬åœ°ç»“æœï¼š\n${localResults.join('\n')}`);
      } else {
        // æœ¬åœ°æ— ç»“æœï¼Œè·³è½¬ç™¾åº¦æœç´¢
        window.open(`https://www.baidu.com/s?wd=${encodeURIComponent(keyword)}`);
      }
    }

    // æœç´¢æœ¬åœ°æ•°æ®
    function searchLocalData(keyword) {
      const results = [];
      const lowerKeyword = keyword.toLowerCase();
      
      // æœç´¢æ—¥ç¨‹
      const schedules = JSON.parse(localStorage.getItem('schedules') || '[]');
      schedules.forEach(item => {
        if (item.title.toLowerCase().includes(lowerKeyword) || 
            item.location.toLowerCase().includes(lowerKeyword)) {
          results.push(`æ—¥ç¨‹ï¼š${item.title}`);
        }
      });
      
      // æœç´¢èµ„æº
      const resources = JSON.parse(localStorage.getItem('resources') || '[]');
      resources.forEach(item => {
        if (item.name.toLowerCase().includes(lowerKeyword) || 
            item.category.toLowerCase().includes(lowerKeyword)) {
          results.push(`èµ„æºï¼š${item.name}`);
        }
      });
      
      // æœç´¢é—®ç­”
      const questions = JSON.parse(localStorage.getItem('questions') || '[]');
      questions.forEach(item => {
        if (item.title.toLowerCase().includes(lowerKeyword) || 
            item.content.toLowerCase().includes(lowerKeyword) ||
            item.tags.some(tag => tag.toLowerCase().includes(lowerKeyword))) {
          results.push(`é—®ç­”ï¼š${item.title}`);
        }
      });
      
      return results;
    }

    // ç™»å½•å‡½æ•°
    function login() {
      const username = document.getElementById('loginUsername').value;
      const password = document.getElementById('loginPassword').value;
      const errorEl = document.getElementById('loginError');
      
      if (!username || !password) {
        errorEl.textContent = 'ç”¨æˆ·åå’Œå¯†ç ä¸èƒ½ä¸ºç©º';
        return;
      }
      
      Auth.login(username, password).then(result => {
        if (!result.success) {
          errorEl.textContent = result.message;
        } else {
          document.getElementById('loginUsername').value = '';
          document.getElementById('loginPassword').value = '';
          errorEl.textContent = '';
        }
      });
    }

    // æ ¡å›­æ—¥ç¨‹æ¨¡å—
    const Schedule = {
      data: [],
      
      load() {
        this.data = JSON.parse(localStorage.getItem('schedules') || '[]');
        // åªæ˜¾ç¤ºå½“å‰ç”¨æˆ·çš„æ—¥ç¨‹
        const currentUserId = Auth.getCurrentUserId();
        if (currentUserId) {
          this.data = this.data.filter(item => item.userId === currentUserId);
        } else {
          this.data = [];
        }
        this.render();
      },
      
      render() {
        const container = document.getElementById('scheduleList');
        if (!container) return;
        
        if (this.data.length === 0) {
          container.innerHTML = '<p>æš‚æ— æ—¥ç¨‹ï¼Œç‚¹å‡»"æ·»åŠ æ—¥ç¨‹"åˆ›å»ºæ–°æ—¥ç¨‹</p>';
          return;
        }
        
        // æŒ‰æ—¶é—´æ’åº
        this.data.sort((a, b) => new Date(a.time) - new Date(b.time));
        
        container.innerHTML = this.data.map(item => `
          <div class="schedule-item">
            <h4>${item.title}</h4>
            <p>æ—¶é—´ï¼š${item.time}</p>
            <p>åœ°ç‚¹ï¼š${item.location}</p>
            <div class="actions">
              <button class="btn" onclick="Schedule.edit('${item.id}')">ç¼–è¾‘</button>
              <button class="btn" style="background-color: #ff4d4f;" onclick="Schedule.delete('${item.id}')">åˆ é™¤</button>
            </div>
          </div>
        `).join('');
      },
      
      add() {
        if (!Auth.getCurrentUserId()) {
          alert('è¯·å…ˆç™»å½•');
          return;
        }
        
        const title = document.getElementById('scheduleTitle').value;
        const time = document.getElementById('scheduleTime').value;
        const location = document.getElementById('scheduleLocation').value;
        
        // éªŒè¯
        const validation = Validator.validateSchedule({ title, time, location });
        if (!validation.valid) {
          Validator.showErrors('scheduleErrors', validation.errors);
          return;
        }
        
        const newItem = {
          id: Date.now().toString(),
          title,
          time,
          location,
          userId: Auth.getCurrentUserId()
        };
        
        this.data.push(newItem);
        localStorage.setItem('schedules', JSON.stringify(this.data));
        this.render();
        
        // é‡ç½®è¡¨å•
        document.getElementById('scheduleTitle').value = '';
        document.getElementById('scheduleTime').value = '';
        document.getElementById('scheduleLocation').value = '';
        document.getElementById('scheduleErrors').innerHTML = '';
        hideAddScheduleForm();
      },
      
      edit(id) {
        const item = this.data.find(i => i.id === id);
        if (!item) return;
        
        document.getElementById('scheduleTitle').value = item.title;
        document.getElementById('scheduleTime').value = item.time;
        document.getElementById('scheduleLocation').value = item.location;
        
        // å°†æ·»åŠ æŒ‰é’®æ”¹ä¸ºæ›´æ–°æŒ‰é’®
        const saveBtn = document.querySelector('#scheduleForm .btn:first-of-type');
        saveBtn.textContent = 'æ›´æ–°';
        saveBtn.onclick = () => {
          // éªŒè¯
          const validation = Validator.validateSchedule({ 
            title: document.getElementById('scheduleTitle').value,
            time: document.getElementById('scheduleTime').value,
            location: document.getElementById('scheduleLocation').value
          });
          if (!validation.valid) {
            Validator.showErrors('scheduleErrors', validation.errors);
            return;
          }
          
          item.title = document.getElementById('scheduleTitle').value;
          item.time = document.getElementById('scheduleTime').value;
          item.location = document.getElementById('scheduleLocation').value;
          
          localStorage.setItem('schedules', JSON.stringify(this.data));
          this.render();
          
          // é‡ç½®è¡¨å•å’ŒæŒ‰é’®
          document.getElementById('scheduleTitle').value = '';
          document.getElementById('scheduleTime').value = '';
          document.getElementById('scheduleLocation').value = '';
          document.getElementById('scheduleErrors').innerHTML = '';
          saveBtn.textContent = 'ä¿å­˜';
          saveBtn.onclick = () => Schedule.add();
          hideAddScheduleForm();
        };
        
        showAddScheduleForm();
      },
      
      delete(id) {
        if (confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªæ—¥ç¨‹å—ï¼Ÿ')) {
          this.data = this.data.filter(item => item.id !== id);
          localStorage.setItem('schedules', JSON.stringify(this.data));
          this.render();
        }
      }
    };

    // å­¦ä¹ èµ„æºæ¨¡å—
    const Resources = {
      data: [],
      
      load() {
        this.data = JSON.parse(localStorage.getItem('resources') || '[]');
        this.render();
      },
      
      render() {
        const container = document.getElementById('resourcesList');
        if (!container) return;
        
        if (this.data.length === 0) {
          container.innerHTML = '<p>æš‚æ— èµ„æºï¼Œç‚¹å‡»"ä¸Šä¼ èµ„æº"åˆ†äº«å­¦ä¹ èµ„æ–™</p>';
          return;
        }
        
        container.innerHTML = this.data.map(item => `
          <div class="resource-item">
            <h4>${item.name} <span style="font-size: 0.8rem; color: #666;">[${item.category}]</span></h4>
            <p>ä¸Šä¼ è€…ï¼š${item.uploader}</p>
            <a href="${item.url}" target="_blank" class="btn" style="display: inline-block; margin-top: 0.5rem;">æŸ¥çœ‹èµ„æº</a>
            ${item.userId === Auth.getCurrentUserId() ? `
              <div class="actions" style="margin-top: 0.5rem;">
                <button class="btn" onclick="Resources.edit('${item.id}')">ç¼–è¾‘</button>
                <button class="btn" style="background-color: #ff4d4f;" onclick="Resources.delete('${item.id}')">åˆ é™¤</button>
              </div>
            ` : ''}
          </div>
        `).join('');
      },
      
      add() {
        if (!Auth.getCurrentUserId()) {
          alert('è¯·å…ˆç™»å½•');
          return;
        }
        
        const name = document.getElementById('resourceName').value;
        const category = document.getElementById('resourceCategory').value;
        const url = document.getElementById('resourceUrl').value;
        
        if (!name || !url) {
          alert('èµ„æºåç§°å’Œé“¾æ¥ä¸èƒ½ä¸ºç©º');
          return;
        }
        
        const newItem = {
          id: Date.now().toString(),
          name,
          category,
          url,
          uploader: Auth.getCurrentUsername(),
          userId: Auth.getCurrentUserId(),
          uploadTime: new Date().toLocaleString()
        };
        
        this.data.push(newItem);
        localStorage.setItem('resources', JSON.stringify(this.data));
        this.render();
        
        // é‡ç½®è¡¨å•
        document.getElementById('resourceName').value = '';
        document.getElementById('resourceUrl').value = '';
        hideAddResourceForm();
      },
      
      edit(id) {
        const item = this.data.find(i => i.id === id);
        if (!item || item.userId !== Auth.getCurrentUserId()) return;
        
        document.getElementById('resourceName').value = item.name;
        document.getElementById('resourceCategory').value = item.category;
        document.getElementById('resourceUrl').value = item.url;
        
        // å°†æ·»åŠ æŒ‰é’®æ”¹ä¸ºæ›´æ–°æŒ‰é’®
        const saveBtn = document.querySelector('#resourceForm .btn:first-of-type');
        saveBtn.textContent = 'æ›´æ–°';
        saveBtn.onclick = () => {
          const name = document.getElementById('resourceName').value;
          const category = document.getElementById('resourceCategory').value;
          const url = document.getElementById('resourceUrl').value;
          
          if (!name || !url) {
            alert('èµ„æºåç§°å’Œé“¾æ¥ä¸èƒ½ä¸ºç©º');
            return;
          }
          
          item.name = name;
          item.category = category;
          item.url = url;
          
          localStorage.setItem('resources', JSON.stringify(this.data));
          this.render();
          
          // é‡ç½®è¡¨å•å’ŒæŒ‰é’®
          document.getElementById('resourceName').value = '';
          document.getElementById('resourceUrl').value = '';
          saveBtn.textContent = 'ä¿å­˜';
          saveBtn.onclick = () => Resources.add();
          hideAddResourceForm();
        };
        
        showAddResourceForm();
      },
      
      delete(id) {
        const item = this.data.find(i => i.id === id);
        if (!item || item.userId !== Auth.getCurrentUserId()) return;
        
        if (confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªèµ„æºå—ï¼Ÿ')) {
          this.data = this.data.filter(item => item.id !== id);
          localStorage.setItem('resources', JSON.stringify(this.data));
          this.render();
        }
      }
    };

    // äº’åŠ©é—®ç­”æ¨¡å—
    const QA = {
      questions: [],
      answers: [],
      
      load() {
        this.questions = JSON.parse(localStorage.getItem('questions') || '[]');
        this.answers = JSON.parse(localStorage.getItem('answers') || '[]');
        this.renderQuestions();
      },
      
      renderQuestions() {
        const container = document.getElementById('qaList');
        if (!container) return;
        
        if (this.questions.length === 0) {
          container.innerHTML = '<p>æš‚æ— é—®é¢˜ï¼Œç‚¹å‡»"æé—®"å‘èµ·æ–°é—®é¢˜</p>';
          return;
        }
        
        container.innerHTML = this.questions.map(question => {
          const questionAnswers = this.answers.filter(a => a.questionId === question.id);
          return `
            <div class="qa-item">
              <h3>${question.title}</h3>
              <p>æ ‡ç­¾ï¼š${question.tags.map(tag => `<span style="background-color: var(--accent-color); padding: 2px 6px; border-radius: 4px; font-size: 0.8rem; margin-right: 5px;">${tag}</span>`).join('')}</p>
              <p>${question.content}</p>
              <p style="margin-top: 0.5rem; font-size: 0.9rem;">
                æé—®è€…ï¼š${question.username} 
                ${question.role === 'super_admin' ? '<span class="role-super">ğŸ‘‘è¶…çº§ç®¡ç†å‘˜</span>' : 
                  question.role === 'admin' ? '<span class="role-admin">ğŸ›¡ï¸ç®¡ç†å‘˜</span>' : ''}
                Â· æ—¶é—´ï¼š${question.createTime}
              </p>
              <p style="margin-top: 0.5rem;"><strong>å›ç­”(${questionAnswers.length})ï¼š</strong></p>
              <div style="margin-left: 1rem; margin-bottom: 1rem;">
                ${questionAnswers.length > 0 ? questionAnswers.map(answer => `
                  <div style="margin-bottom: 1rem; padding-bottom: 1rem; border-bottom: 1px solid var(--border-color);">
                    <p>${answer.content}</p>
                    <p style="font-size: 0.9rem; margin-top: 0.5rem;">
                      å›ç­”è€…ï¼š${answer.username}
                      ${answer.isAccepted ? '<span style="background-color: #52C41A; color: white; padding: 2px 6px; border-radius: 4px; font-size: 0.8rem; margin-left: 5px;">æœ€ä½³ç­”æ¡ˆ</span>' : ''}
                    </p>
                    ${question.userId === Auth.getCurrentUserId() && !answer.isAccepted ? 
                      `<button class="btn" style="font-size: 0.8rem; padding: 2px 8px;" onclick="QA.acceptAnswer('${answer.id}', '${question.id}')">é‡‡çº³ä¸ºæœ€ä½³ç­”æ¡ˆ</button>` : ''}
                  </div>
                `).join('') : '<p>æš‚æ— å›ç­”ï¼Œå¿«æ¥æŠ¢æ²™å‘å§ï¼</p>'}
              </div>
              ${Auth.getCurrentUserId() ? `
                <div style="margin-top: 1rem;">
                  <textarea id="answerContent-${question.id}" rows="2" placeholder="å†™ä¸‹ä½ çš„å›ç­”..."></textarea>
                  <button class="btn" style="margin-top: 0.5rem;" onclick="QA.addAnswer('${question.id}')">æäº¤å›ç­”</button>
                </div>
              ` : '<p>è¯·ç™»å½•åå›ç­”é—®é¢˜</p>'}
            </div>
          `;
        }).join('');
      },
      
      addQuestion() {
        if (!Auth.getCurrentUserId()) {
          alert('è¯·å…ˆç™»å½•');
          return;
        }
        
        const title = document.getElementById('questionTitle').value;
        const content = document.getElementById('questionContent').value;
        const tagsInput = document.getElementById('questionTags').value;
        
        if (!title || !content) {
          alert('é—®é¢˜æ ‡é¢˜å’Œå†…å®¹ä¸èƒ½ä¸ºç©º');
          return;
        }
        
        const tags = tagsInput ? tagsInput.split(',').map(tag => tag.trim()) : [];
        
        const newQuestion = {
          id: Date.now().toString(),
          title,
          content,
          tags,
          userId: Auth.getCurrentUserId(),
          username: Auth.getCurrentUsername(),
          role: Auth.currentRole || Config.ROLES.USER,
          createTime: new Date().toLocaleString()
        };
        
        this.questions.push(newQuestion);
        localStorage.setItem('questions', JSON.stringify(this.questions));
        this.renderQuestions();
        
        // é‡ç½®è¡¨å•
        document.getElementById('questionTitle').value = '';
        document.getElementById('questionContent').value = '';
        document.getElementById('questionTags').value = '';
        hideAddQuestionForm();
      },
      
      addAnswer(questionId) {
        if (!Auth.getCurrentUserId()) {
          alert('è¯·å…ˆç™»å½•');
          return;
        }
        
        const content = document.getElementById(`answerContent-${questionId}`).value;
        if (!content) {
          alert('å›ç­”å†…å®¹ä¸èƒ½ä¸ºç©º');
          return;
        }
        
        const newAnswer = {
          id: Date.now().toString() + '-answer',
          questionId,
          content,
          userId: Auth.getCurrentUserId(),
          username: Auth.getCurrentUsername(),
          createTime: new Date().toLocaleString(),
          isAccepted: false
        };
        
        this.answers.push(newAnswer);
        localStorage.setItem('answers', JSON.stringify(this.answers));
        this.renderQuestions();
        
        // æ¸…ç©ºè¾“å…¥æ¡†
        document.getElementById(`answerContent-${questionId}`).value = '';
      },
      
      acceptAnswer(answerId, questionId) {
        // æ£€æŸ¥æ˜¯å¦æ˜¯æé—®è€…
        const question = this.questions.find(q => q.id === questionId);
        if (!question || question.userId !== Auth.getCurrentUserId()) return;
        
        // å°†æ‰€æœ‰ç­”æ¡ˆè®¾ä¸ºæœªé‡‡çº³ï¼Œå†å°†å½“å‰ç­”æ¡ˆè®¾ä¸ºé‡‡çº³
        this.answers = this.answers.map(answer => {
          if (answer.questionId === questionId) {
            answer.isAccepted = answer.id === answerId;
          }
          return answer;
        });
        
        localStorage.setItem('answers', JSON.stringify(this.answers));
        this.renderQuestions();
      }
    };

    // ç®¡ç†ä¸­å¿ƒæ¨¡å—
    const Admin = {
      loadUserList() {
        // ä»…ç®¡ç†å‘˜/è¶…ç®¡å¯è®¿é—®
        if (!Auth.hasAdminPermission()) {
          document.getElementById('adminCenterPage').innerHTML = '<p>æ— æƒé™è®¿é—®ç®¡ç†ä¸­å¿ƒ</p>';
          return;
        }
        
        // æ¨¡æ‹Ÿæ•°æ®ï¼Œå®é™…é¡¹ç›®ä¸­æ›¿æ¢ä¸ºLeanCloudæŸ¥è¯¢_Userè¡¨
        const mockUsers = [
          { id: '1', username: 'å¼ ä¸‰', role: 'super_admin', online: true, registerTime: '2024-01-10' },
          { id: '2', username: 'æå››', role: 'admin', online: false, registerTime: '2024-02-15' },
          { id: '3', username: 'ç‹äº”', role: 'user', online: true, registerTime: '2024-03-20' },
          { id: '4', username: 'èµµå…­', role: 'user', online: false, registerTime: '2024-04-05' }
        ];
        
        const tableBody = document.getElementById('userTableBody');
        tableBody.innerHTML = mockUsers.map(user => `
          <tr>
            <td><span class="online-status ${user.online ? 'online' : 'offline'}"></span></td>
            <td>${user.username}</td>
            <td>
              <span class="role-${user.role === 'super_admin' ? 'super' : user.role === 'admin' ? 'admin' : ''}">
                ${user.role === 'super_admin' ? 'ğŸ‘‘è¶…çº§ç®¡ç†å‘˜' : user.role === 'admin' ? 'ğŸ›¡ï¸ç®¡ç†å‘˜' : 'æ™®é€šç”¨æˆ·'}
              </span>
            </td>
            <td>${user.registerTime}</td>
            <td class="actions">
              ${Auth.isSuperAdmin() ? `
                <button class="btn" onclick="Admin.changeRole('${user.id}', '${user.role}')">
                  ${user.role === 'user' ? 'è®¾ä¸ºç®¡ç†å‘˜' : user.role === 'admin' ? 'æ’¤é”€ç®¡ç†å‘˜' : ''}
                </button>
                ${user.role !== 'super_admin' ? `<button class="btn" style="background-color: #ff4d4f;" onclick="Admin.deleteUser('${user.id}')">åˆ é™¤</button>` : ''}
              ` : '<button class="btn" onclick="Admin.editUser(\''+user.id+'\')">ç¼–è¾‘</button>'}
            </td>
          </tr>
        `).join('');
        
        // æ›´æ–°ç»Ÿè®¡æ•°æ®
        document.getElementById('totalUsers').textContent = mockUsers.length;
      },
      
      loadApplications() {
        // æ¨¡æ‹Ÿæ•°æ®
        const mockApplications = [
          { id: '1', username: 'é’±ä¸ƒ', phone: '13800138000', reason: 'éœ€è¦ä½¿ç”¨å›¾ä¹¦é¦†èµ„æº', time: '2024-05-01' },
          { id: '2', username: 'å­™å…«', phone: '13900139000', reason: 'è¯¾ç¨‹å­¦ä¹ éœ€è¦', time: '2024-05-05' }
        ];
        
        const tableBody = document.getElementById('applicationTableBody');
        tableBody.innerHTML = mockApplications.map(app => `
          <tr>
            <td>${app.username}</td>
            <td>${app.phone}</td>
            <td>${app.reason}</td>
            <td>${app.time}</td>
            <td class="actions">
              <button class="btn" onclick="Admin.approveApplication('${app.id}')">åŒæ„</button>
              <button class="btn" style="background-color: #ff4d4f;" onclick="Admin.rejectApplication('${app.id}')">æ‹’ç»</button>
            </td>
          </tr>
        `).join('');
        
        // æ›´æ–°ç»Ÿè®¡æ•°æ®
        document.getElementById('pendingApplications').textContent = mockApplications.length;
      },
      
      changeRole(userId, currentRole) {
        if (!Auth.isSuperAdmin()) return;
        
        const newRole = currentRole === 'user' ? 'admin' : 'user';
        if (confirm(`ç¡®å®šè¦å°†ç”¨æˆ·è®¾ä¸º${newRole === 'admin' ? 'ç®¡ç†å‘˜' : 'æ™®é€šç”¨æˆ·'}å—ï¼Ÿ`)) {
          // å®é™…é¡¹ç›®ä¸­æ›¿æ¢ä¸ºï¼šLeanCloudæ›´æ–°ç”¨æˆ·è§’è‰²
          alert('è§’è‰²å·²æ›´æ–°');
          this.loadUserList(); // åˆ·æ–°åˆ—è¡¨
        }
      },
      
      deleteUser(userId) {
        if (!Auth.isSuperAdmin()) return;
        
        if (confirm('ç¡®å®šè¦åˆ é™¤è¯¥ç”¨æˆ·å—ï¼Ÿ')) {
          // å®é™…é¡¹ç›®ä¸­æ›¿æ¢ä¸ºï¼šLeanCloudåˆ é™¤ç”¨æˆ·
          alert('ç”¨æˆ·å·²åˆ é™¤');
          this.loadUserList();
        }
      },
      
      editUser(userId) {
        alert(`ç¼–è¾‘ç”¨æˆ· ${userId} çš„ä¿¡æ¯ï¼ˆæ¨¡æ‹Ÿæ“ä½œï¼‰`);
      },
      
      approveApplication(appId) {
        if (confirm('ç¡®å®šè¦åŒæ„è¯¥ç”³è¯·å—ï¼Ÿ')) {
          // å®é™…é¡¹ç›®ä¸­æ›¿æ¢ä¸ºï¼šLeanCloudæ›´æ–°ç”³è¯·çŠ¶æ€å¹¶åˆ›å»ºç”¨æˆ·
          alert('ç”³è¯·å·²åŒæ„ï¼Œå·²åˆ›å»ºé»˜è®¤è´¦å·');
          this.loadApplications();
        }
      },
      
      rejectApplication(appId) {
        const reason = prompt('è¯·è¾“å…¥æ‹’ç»ç†ç”±ï¼š');
        if (reason) {
          // å®é™…é¡¹ç›®ä¸­æ›¿æ¢ä¸ºï¼šLeanCloudæ›´æ–°ç”³è¯·çŠ¶æ€å’Œæ‹’ç»ç†ç”±
          alert('ç”³è¯·å·²æ‹’ç»');
          this.loadApplications();
        }
      }
    };

    // æ•°æ®å¤‡ä»½æ¨¡å—
    const Backup = {
      // å¯¼å‡ºæ•°æ®
      export() {
        const backupData = {
          schedules: JSON.parse(localStorage.getItem('schedules') || '[]'),
          resources: JSON.parse(localStorage.getItem('resources') || '[]'),
          questions: JSON.parse(localStorage.getItem('questions') || '[]'),
          answers: JSON.parse(localStorage.getItem('answers') || '[]'),
          exportTime: new Date().toLocaleString()
        };
        
        // ç”ŸæˆJSONæ–‡ä»¶å¹¶ä¸‹è½½
        const blob = new Blob([JSON.stringify(backupData, null, 2)], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `campus-data-backup-${Date.now()}.json`;
        a.click();
        URL.revokeObjectURL(url);
      },
      
      // å¯¼å…¥æ•°æ®
      import(file) {
        if (!file) return;
        
        const reader = new FileReader();
        reader.onload = (e) => {
          try {
            const data = JSON.parse(e.target.result);
            if (confirm('ç¡®å®šè¦å¯¼å…¥æ•°æ®å—ï¼Ÿè¿™å°†è¦†ç›–ç°æœ‰æ•°æ®')) {
              // å¯¼å…¥æ•°æ®
              if (data.schedules) {
                localStorage.setItem('schedules', JSON.stringify(data.schedules));
              }
              if (data.resources) {
                localStorage.setItem('resources', JSON.stringify(data.resources));
              }
              if (data.questions) {
                localStorage.setItem('questions', JSON.stringify(data.questions));
              }
              if (data.answers) {
                localStorage.setItem('answers', JSON.stringify(data.answers));
              }
              
              alert('æ•°æ®å¯¼å…¥æˆåŠŸï¼');
              // åˆ·æ–°å½“å‰é¡µé¢
              const currentPage = document.querySelector('.page.active').id;
              switchPage(currentPage);
            }
          } catch (err) {
            alert('å¯¼å…¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥æ–‡ä»¶æ ¼å¼æ˜¯å¦æ­£ç¡®');
            console.error('å¯¼å…¥æ•°æ®é”™è¯¯:', err);
          }
        };
        reader.readAsText(file);
      }
    };

    // ä¸ªäººä¸­å¿ƒæ¨¡å—
    const Profile = {
      load() {
        const container = document.getElementById('profileInfo');
        if (!container) return;
        
        if (Auth.currentUser) {
          container.innerHTML = `
            <p><strong>ç”¨æˆ·åï¼š</strong>${Auth.currentUser.username}</p>
            <p><strong>æ³¨å†Œæ—¶é—´ï¼š</strong>${Auth.currentUser.createdAt ? new Date(Auth.currentUser.createdAt).toLocaleString() : 'æœªçŸ¥'}</p>
            <p><strong>è§’è‰²ï¼š</strong>${Auth.currentRole === Config.ROLES.SUPER_ADMIN ? 'ğŸ‘‘è¶…çº§ç®¡ç†å‘˜' : 
              Auth.currentRole === Config.ROLES.ADMIN ? 'ğŸ›¡ï¸ç®¡ç†å‘˜' : 'æ™®é€šç”¨æˆ·'}</p>
            <button class="btn" style="margin-top: 1rem;" onclick="Auth.logout()">é€€å‡ºç™»å½•</button>
          `;
        } else {
          container.innerHTML = `
            <p>è¯·å…ˆç™»å½•ä»¥æŸ¥çœ‹ä¸ªäººä¿¡æ¯</p>
            <button class="btn" onclick="document.getElementById('loginModal').style.display = 'flex'">ç™»å½•</button>
          `;
        }
      }
    };

    // è¡¨å•éªŒè¯å·¥å…·
    const Validator = {
      // éªŒè¯è´¦å·ç”³è¯·è¡¨å•
      validateApplication(formData) {
        const errors = [];
        if (!formData.username) errors.push('ç”¨æˆ·åä¸èƒ½ä¸ºç©º');
        if (!formData.phone) {
          errors.push('æ‰‹æœºå·ä¸èƒ½ä¸ºç©º');
        } else if (!/^1[3-9]\d{9}$/.test(formData.phone)) {
          errors.push('æ‰‹æœºå·æ ¼å¼ä¸æ­£ç¡®');
        }
        if (!formData.reason) errors.push('ç”³è¯·ç†ç”±ä¸èƒ½ä¸ºç©º');
        return { valid: errors.length === 0, errors };
      },
      
      // éªŒè¯æ—¥ç¨‹è¡¨å•
      validateSchedule(formData) {
        const errors = [];
        if (!formData.title) errors.push('æ—¥ç¨‹æ ‡é¢˜ä¸èƒ½ä¸ºç©º');
        if (!formData.time) {
          errors.push('æ—¶é—´ä¸èƒ½ä¸ºç©º');
        } else if (!/^\d{4}-\d{2}-\d{2} \d{2}:\d{2}$/.test(formData.time)) {
          errors.push('æ—¶é—´æ ¼å¼åº”ä¸ºï¼š2024-05-20 08:00');
        }
        return { valid: errors.length === 0, errors };
      },
      
      // æ˜¾ç¤ºé”™è¯¯æç¤º
      showErrors(containerId, errors) {
        const container = document.getElementById(containerId);
        if (container) {
          container.innerHTML = errors.map(err => `<p class="error">${err}</p>`).join('');
        }
      }
    };

    // è¾…åŠ©å‡½æ•°ï¼šæ˜¾ç¤º/éšè—è¡¨å•
    function showAddScheduleForm() {
      document.getElementById('scheduleForm').style.display = 'block';
    }
    
    function hideAddScheduleForm() {
      document.getElementById('scheduleForm').style.display = 'none';
      document.getElementById('scheduleErrors').innerHTML = '';
      // é‡ç½®æŒ‰é’®äº‹ä»¶
      const saveBtn = document.querySelector('#scheduleForm .btn:first-of-type');
      saveBtn.textContent = 'ä¿å­˜';
      saveBtn.onclick = () => Schedule.add();
    }
    
    function showAddResourceForm() {
      document.getElementById('resourceForm').style.display = 'block';
    }
    
    function hideAddResourceForm() {
      document.getElementById('resourceForm').style.display = 'none';
    }
    
    function showAddQuestionForm() {
      document.getElementById('questionForm').style.display = 'block';
    }
    
    function hideAddQuestionForm() {
      document.getElementById('questionForm').style.display = 'none';
    }

    // å…¶ä»–åŠŸèƒ½å‡½æ•°
    // å…¶ä»–åŠŸèƒ½å‡½æ•°
    function submitApplication() {
      const username = document.getElementById('appUsername').value;
      const phone = document.getElementById('appPhone').value;
      const reason = document.getElementById('appReason').value;
      
      const validation = Validator.validateApplication({ username, phone, reason });
      if (!validation.valid) {
        Validator.showErrors('applicationErrors', validation.errors);
        return;
      }
      
      // å®é™…é¡¹ç›®ä¸­æ›¿æ¢ä¸ºLeanCloudæäº¤ç”³è¯·
      alert('ç”³è¯·å·²æäº¤ï¼Œç­‰å¾…ç®¡ç†å‘˜å®¡æ ¸');
      document.getElementById('applicationForm').reset();
      document.getElementById('applicationErrors').innerHTML = '';
    }
    
    function submitPasswordReset() {
      const username = document.getElementById('resetUsername').value;
      
      if (!username) {
        alert('è¯·è¾“å…¥ç”¨æˆ·å');
        return;
      }
      
      // å®é™…é¡¹ç›®ä¸­æ›¿æ¢ä¸ºLeanCloudæäº¤é‡ç½®ç”³è¯·
      alert(`å¯†ç é‡ç½®ç”³è¯·å·²æäº¤ï¼Œå°†å‘é€é€šçŸ¥ç»™ ${username}`);
      document.getElementById('resetUsername').value = '';
    }
    
    function publishAnnouncement() {
      if (!Auth.hasAdminPermission()) {
        alert('æ— æƒé™å‘å¸ƒå…¬å‘Š');
        return;
      }
      
      const title = document.getElementById('annTitle').value;
      const content = document.getElementById('annContent').value;
      
      if (!title || !content) {
        alert('æ ‡é¢˜å’Œå†…å®¹ä¸èƒ½ä¸ºç©º');
        return;
      }
      
      // å®é™…é¡¹ç›®ä¸­æ›¿æ¢ä¸ºLeanCloudä¿å­˜å…¬å‘Š
      alert('å…¬å‘Šå‘å¸ƒæˆåŠŸ');
      
      // æ›´æ–°å…¬å‘Šåˆ—è¡¨
      const list = document.getElementById('announcementList');
      const newAnnouncement = document.createElement('div');
      newAnnouncement.className = 'card';
      newAnnouncement.innerHTML = `
        <h3>${title}</h3>
        <p>${content}</p>
        <p style="margin-top: 1rem; font-size: 0.9rem;">
          å‘å¸ƒäººï¼š${Auth.getCurrentUsername()} 
          ${Auth.currentRole === 'super_admin' ? '<span class="role-super">ğŸ‘‘è¶…çº§ç®¡ç†å‘˜</span>' : 
            Auth.currentRole === 'admin' ? '<span class="role-admin">ğŸ›¡ï¸ç®¡ç†å‘˜</span>' : ''}
          Â· æ—¶é—´ï¼š${new Date().toLocaleString()}
        </p>
      `;
      
      if (list.firstChild) {
        list.insertBefore(newAnnouncement, list.firstChild);
      } else {
        list.appendChild(newAnnouncement);
      }
      
      // æ¸…ç©ºè¡¨å•
      document.getElementById('annTitle').value = '';
      document.getElementById('annContent').value = '';
      
      // æ›´æ–°ç»Ÿè®¡
      const count = document.getElementById('totalAnnouncements');
      count.textContent = parseInt(count.textContent) + 1;
    }
    
    function sendMessage() {
      if (!Auth.getCurrentUserId()) {
        alert('è¯·å…ˆç™»å½•');
        return;
      }
      
      const content = document.getElementById('messageContent').value;
      if (!content) return;
      
      // å®é™…é¡¹ç›®ä¸­æ›¿æ¢ä¸ºLeanCloudä¿å­˜æ¶ˆæ¯
      const list = document.getElementById('messageList');
      const newMessage = document.createElement('div');
      newMessage.style.marginBottom = '1rem';
      newMessage.innerHTML = `
        <p><strong>${Auth.getCurrentUsername()} 
          ${Auth.currentRole === 'super_admin' ? '<span class="role-super">ğŸ‘‘è¶…çº§ç®¡ç†å‘˜</span>' : 
            Auth.currentRole === 'admin' ? '<span class="role-admin">ğŸ›¡ï¸ç®¡ç†å‘˜</span>' : ''}
          <span style="font-size: 0.8rem; color: #666;">${new Date().toLocaleTimeString()}</span></strong></p>
        <p>${content}</p>
      `;
      list.appendChild(newMessage);
      
      // æ»šåŠ¨åˆ°åº•éƒ¨
      list.scrollTop = list.scrollHeight;
      
      // æ¸…ç©ºè¾“å…¥æ¡†
      document.getElementById('messageContent').value = '';
    }
    
    function submitSuggestion() {
      if (!Auth.getCurrentUserId()) {
        alert('è¯·å…ˆç™»å½•');
        return;
      }
      
      const content = document.getElementById('suggestionContent').value;
      if (!content) {
        alert('è¯·è¾“å…¥å»ºè®®å†…å®¹');
        return;
      }
      
      // å®é™…é¡¹ç›®ä¸­æ›¿æ¢ä¸ºLeanCloudä¿å­˜å»ºè®®
      alert('å»ºè®®æäº¤æˆåŠŸï¼Œæ„Ÿè°¢æ‚¨çš„åé¦ˆ');
      
      // æ›´æ–°æˆ‘çš„å»ºè®®åˆ—è¡¨
      const list = document.getElementById('mySuggestions');
      const newSuggestion = document.createElement('div');
      newSuggestion.className = 'card';
      newSuggestion.innerHTML = `
        <p>${content}</p>
        <p style="margin-top: 1rem; font-size: 0.9rem;">
          æäº¤æ—¶é—´ï¼š${new Date().toLocaleString()}
          <span style="margin-left: 1rem; background-color: #FBBF24; padding: 2px 6px; border-radius: 4px; font-size: 0.8rem;">å¾…å¤„ç†</span>
        </p>
      `;
      
      if (list.firstChild) {
        list.insertBefore(newSuggestion, list.firstChild);
      } else {
        list.appendChild(newSuggestion);
      }
      
      // æ¸…ç©ºè¾“å…¥æ¡†
      document.getElementById('suggestionContent').value = '';
    }

    // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
    window.onload = () => {
      // åˆå§‹åŒ–LeanCloud
      initLeanCloud();
      
      // åˆå§‹åŒ–æƒé™ä¸ç™»å½•
      Auth.init();
      
      // åŠ è½½ä¿å­˜çš„ä¸»é¢˜
      const savedTheme = localStorage.getItem('selectedTheme') || 'default';
      switchTheme(savedTheme);
      
      // åˆå§‹åŒ–é¦–é¡µæ•°æ®
      // åŠ è½½å…¬å‘Šç¤ºä¾‹æ•°æ®
      const annList = document.getElementById('announcementList');
      annList.innerHTML = `
        <div class="card">
          <h3>æ¬¢è¿ä½¿ç”¨æ ¡å›­ç®¡ç†ç³»ç»Ÿ</h3>
          <p>æœ¬ç³»ç»Ÿæä¾›è´¦å·ç®¡ç†ã€æ—¥ç¨‹å®‰æ’ã€å­¦ä¹ èµ„æºåˆ†äº«ç­‰åŠŸèƒ½ï¼Œæ¬¢è¿ä½¿ç”¨å¹¶æå‡ºå®è´µå»ºè®®ã€‚</p>
          <p style="margin-top: 1rem; font-size: 0.9rem;">
            å‘å¸ƒäººï¼šç³»ç»Ÿç®¡ç†å‘˜ <span class="role-super">ğŸ‘‘è¶…çº§ç®¡ç†å‘˜</span>
            Â· æ—¶é—´ï¼š2024-01-01
          </p>
        </div>
      `;
      document.getElementById('totalAnnouncements').textContent = '1';
    };
  </script>
</body>
</html>
