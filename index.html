<!DOCTYPE HTML>
<!--
	模板名称：lemon
	
-->
<html>
	<head>
		<!-- 修改网站标题（浏览器标签显示的文字） -->
		<title>我的个人网站</title>
		<meta charset="utf-8" />
		<!-- 移动端适配设置（一般不需要修改） -->
		<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
		<!-- 样式表引用（不要修改路径） -->
		<link rel="stylesheet" href="assets/css/main.css" />
		<noscript><link rel="stylesheet" href="assets/css/noscript.css" /></noscript>
		
		<!-- 聊天功能需要的外部资源 -->
		<script src="https://cdn.tailwindcss.com"></script>
		<link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
		
		<!-- 配置Tailwind颜色以匹配网站风格 -->
		<script>
			tailwind.config = {
				theme: {
					extend: {
						colors: {
							primary: '#3498db', // 匹配网站蓝色主题
						},
					}
				}
			}
		</script>
	</head>
	<body class="is-preload">

		<!-- 整个页面的包裹容器 -->
		<div id="wrapper" class="fade-in">

			<!-- 首屏大标题区域 -->
			<div id="intro">
				<h1>这里是<br />主标题</h1>
				<p>这是我的个人网站，基于HTML5+CSS3构建<br />
				模板设计：<a href="https://twitter.com/ajlkn">@ajlkn</a>，来自 <a href="https://html5up.net">HTML5 UP</a></p>
				<ul class="actions">
					<li><a href="#header" class="button icon solid solo fa-arrow-down scrolly">向下滑动</a></li>
				</ul>
			</div>

			<!-- 顶部标题栏 -->
			<header id="header">
				<a href="index.html" class="logo">网站LOGO</a>
			</header>

			<!-- 导航菜单 -->
			<nav id="nav">
				<ul class="links">
					<!-- 修改导航菜单项 -->
					<li class="active"><a href="index.html">首页</a></li>
					<li><a href="generic.html">关于我</a></li>
					<li><a href="elements.html">作品集</a></li>
				</ul>
				<ul class="icons">
					<!-- 修改社交媒体链接 -->
					<li><a href="#" class="icon brands fa-twitter"><span class="label">Twitter</span></a></li>
					<li><a href="#" class="icon brands fa-weibo"><span class="label">微博</span></a></li>
					<li><a href="#" class="icon brands fa-weixin"><span class="label">微信</span></a></li>
					<li><a href="https://github.com/你的用户名" class="icon brands fa-github"><span class="label">GitHub</span></a></li>
				</ul>
			</nav>

			<!-- 主要内容区 -->
			<div id="main">

				<!-- 置顶文章 -->
				<article class="post featured">
					<header class="major">
						<!-- 修改日期 -->
						<span class="date">2023年10月20日</span>
						<h2><a href="#">这里是文章标题</a></h2>
						<p>这里是文章摘要内容<br />
						可以写一些简单的自我介绍<br />
						或者近期动态</p>
					</header>
					<!-- 修改主图（图片需放在images文件夹） -->
					<a href="#" class="image main"><img src="images/pic01.jpg" alt="主图描述" /></a>
					<ul class="actions special">
						<li><a href="#" class="button large">查看详情</a></li>
					</ul>
				</article>

				<!-- 文章列表区 -->
				<section class="posts">
					<article>
						<header>
							<span class="date">2023年10月15日</span>
							<h2><a href="#">文章标题1</a></h2>
						</header>
						<a href="#" class="image fit"><img src="images/pic02.jpg" alt="配图1" /></a>
						<p>这里是文章1的简短摘要内容，建议控制在2-3行。</p>
						<ul class="actions special">
							<li><a href="#" class="button">阅读更多</a></li>
						</ul>
					</article>
					<article>
						<header>
							<span class="date">2023年10月10日</span>
							<h2><a href="#">文章标题2</a></h2>
						</header>
						<a href="#" class="image fit"><img src="images/pic03.jpg" alt="配图2" /></a>
						<p>这里是文章2的简短摘要内容，建议控制在2-3行。</p>
						<ul class="actions special">
							<li><a href="#" class="button">阅读更多</a></li>
						</ul>
					</article>
				</section>

				<!-- 分页器（如果不需要可以删除） -->
				<footer>
					<div class="pagination">
						<a href="#" class="page active">1</a>
						<a href="#" class="page">2</a>
						<a href="#" class="page">3</a>
					</div>
				</footer>

			</div>

			<!-- 页脚区域 -->
			<footer id="footer">
				<section>
					<!-- 联系表单 -->
					<form method="post" action="#">
						<div class="fields">
							<div class="field">
								<label for="name">姓名</label>
								<input type="text" name="name" id="name" />
							</div>
							<div class="field">
								<label for="email">邮箱</label>
								<input type="text" name="email" id="email" />
							</div>
							<div class="field">
								<label for="message">留言内容</label>
								<textarea name="message" id="message" rows="3"></textarea>
							</div>
						</div>
						<ul class="actions">
							<li><input type="submit" value="发送消息" /></li>
						</ul>
					</form>
				</section>
				<section class="split contact">
					<!-- 联系方式 -->
					<section class="alt">
						<h3>地址</h3>
						<p>中国XX省XX市<br />
						XX区XX路123号</p>
					</section>
					<section>
						<h3>电话</h3>
						<p><a href="#">(123) 456-7890</a></p>
					</section>
					<section>
						<h3>邮箱</h3>
						<p><a href="#">yourname@example.com</a></p>
					</section>
					<section>
						<h3>社交平台</h3>
						<ul class="icons alt">
							<li><a href="#" class="icon brands alt fa-twitter"><span class="label">Twitter</span></a></li>
							<li><a href="#" class="icon brands alt fa-weibo"><span class="label">微博</span></a></li>
							<li><a href="#" class="icon brands alt fa-github"><span class="label">GitHub</span></a></li>
						</ul>
					</section>
				</section>
			</footer>

			<!-- 版权信息 -->
			<div id="copyright">
				<ul><li>&copy; 2023 你的名字</li><li>设计: <a href="https://html5up.net">HTML5 UP</a></li></ul>
			</div>

		</div>

		<!-- 脚本引用（不要修改） -->
		<script src="assets/js/jquery.min.js"></script>
		<script src="assets/js/jquery.scrollex.min.js"></script>
		<script src="assets/js/jquery.scrolly.min.js"></script>
		<script src="assets/js/browser.min.js"></script>
		<script src="assets/js/breakpoints.min.js"></script>
		<script src="assets/js/util.js"></script>
		<script src="assets/js/main.js"></script>

		<!-- 聊天功能开始 -->
		<!-- 聊天窗口容器 -->
		<div id="app-container" class="fixed bottom-6 right-6 z-50 w-80 md:w-96 h-[500px] hidden"></div>

		<!-- 聊天按钮（点击打开聊天窗口） -->
		<button id="chat-toggle" class="fixed bottom-6 right-6 w-14 h-14 bg-blue-500 hover:bg-blue-600 rounded-full shadow-lg flex items-center justify-center text-white z-51 transition-all">
			<i class="fa fa-comments text-xl"></i>
		</button>

		<!-- 聊天功能样式 -->
		<style type="text/tailwindcss">
			@layer utilities {
				.content-auto { content-visibility: auto; }
				.scrollbar-hide {
					-ms-overflow-style: none;
					scrollbar-width: none;
				}
				.scrollbar-hide::-webkit-scrollbar { display: none; }
				.message-appear { animation: fadeIn 0.3s ease forwards; }
				@keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
			}
		</style>

		<!-- 聊天功能HTML结构 -->
		<script id="chat-template" type="text/template">
			<div class="w-full h-full bg-white rounded-xl shadow-2xl overflow-hidden flex flex-col">
				<!-- 初始界面 - 名字设置 -->
				<div id="setup-screen" class="w-full h-full flex flex-col items-center justify-center p-6">
					<div class="w-full">
						<div class="text-center mb-6">
							<div class="w-14 h-14 bg-primary/10 rounded-full flex items-center justify-center mx-auto mb-4">
								<i class="fa fa-comments text-2xl text-primary"></i>
							</div>
							<h1 class="text-xl font-bold text-gray-800">开始聊天</h1>
							<p class="text-gray-500 mt-2">请设置你的名字以开始聊天</p>
						</div>
						
						<form id="name-form" class="space-y-4">
							<div>
								<label for="username" class="block text-sm font-medium text-gray-700 mb-1">你的名字</label>
								<div class="relative">
									<span class="absolute inset-y-0 left-0 flex items-center pl-3 text-gray-500">
										<i class="fa fa-user"></i>
									</span>
									<input type="text" id="username" 
										class="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary/50 focus:border-primary transition-all"
										placeholder="输入你的名字" required>
								</div>
								<p id="name-error" class="mt-1 text-sm text-red-500 hidden">这个名字已被使用，请换一个</p>
							</div>
							
							<button type="submit" 
								class="w-full bg-primary hover:bg-primary/90 text-white font-medium py-2 px-4 rounded-lg transition-all shadow hover:shadow-md flex items-center justify-center">
								<span>进入聊天</span>
								<i class="fa fa-arrow-right ml-2"></i>
							</button>
						</form>
					</div>
				</div>
				
				<!-- 聊天主界面 (默认隐藏) -->
				<div id="chat-interface" class="w-full h-full flex flex-col h-full hidden">
					<!-- 侧边栏 - 联系人列表和搜索 -->
					<div class="w-full bg-gray-50 border-b border-gray-200 flex flex-col h-full">
						<!-- 当前用户信息 -->
						<div class="p-3 border-b border-gray-200 flex items-center justify-between">
							<div class="flex items-center">
								<div class="w-8 h-8 bg-primary/10 rounded-full flex items-center justify-center mr-3">
									<span class="text-primary font-medium" id="current-user-initial">U</span>
								</div>
								<div>
									<h3 class="font-medium text-gray-800 text-sm" id="current-username">用户名</h3>
									<p class="text-xs text-green-500 flex items-center">
										<span class="w-2 h-2 bg-green-500 rounded-full mr-1"></span>在线
									</p>
								</div>
							</div>
							<button id="logout-btn" class="text-gray-500 hover:text-primary transition-colors">
								<i class="fa fa-sign-out"></i>
							</button>
						</div>
						
						<!-- 搜索框 -->
						<div class="p-3 border-b border-gray-200">
							<div class="relative">
								<span class="absolute inset-y-0 left-0 flex items-center pl-3 text-gray-500">
									<i class="fa fa-search"></i>
								</span>
								<input type="text" id="user-search" 
									class="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary/50 focus:border-primary transition-all text-sm"
									placeholder="搜索用户...">
							</div>
						</div>
						
						<!-- 联系人列表 -->
						<div class="flex-1 overflow-y-auto scrollbar-hide">
							<div class="p-2">
								<h4 class="text-xs font-semibold text-gray-500 uppercase tracking-wider px-3 mb-2">在线用户</h4>
								<div id="user-list" class="space-y-1">
									<!-- 用户列表将通过JS动态生成 -->
								</div>
							</div>
						</div>
					</div>
					
					<!-- 聊天区域 -->
					<div class="flex-1 flex flex-col h-full bg-gray-50">
						<!-- 聊天头部 - 当前聊天对象 -->
						<div id="chat-header" class="p-3 border-b border-gray-200 bg-white flex items-center">
							<div class="w-8 h-8 bg-primary/10 rounded-full flex items-center justify-center mr-3">
								<span class="text-primary font-medium" id="active-user-initial">U</span>
							</div>
							<div>
								<h3 class="font-medium text-gray-800 text-sm" id="active-username">选择一个用户开始聊天</h3>
								<p class="text-xs text-green-500 flex items-center" id="active-user-status">
									<span class="w-2 h-2 bg-green-500 rounded-full mr-1"></span>在线
								</p>
							</div>
						</div>
						
						<!-- 聊天消息区域 -->
						<div id="messages-container" class="flex-1 p-3 overflow-y-auto scrollbar-hide space-y-3">
							<!-- 提示信息 -->
							<div id="no-conversation" class="h-full flex items-center justify-center text-gray-400">
								<p>选择一个联系人开始聊天</p>
							</div>
							
							<!-- 消息将通过JS动态生成 -->
							<div id="messages" class="hidden space-y-3"></div>
						</div>
						
						<!-- 消息输入区域 -->
						<div id="message-input-area" class="p-3 border-t border-gray-200 bg-white hidden">
							<form id="message-form" class="flex space-x-2">
								textarea id="message-input" rows="2" 
									class="flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary/50 focus:border-primary transition-all resize-none text-sm"
									placeholder="输入消息..."></textarea>
								<button type="submit" 
									class="bg-primary hover:bg-primary/90 text-white p-2 rounded-lg transition-all">
									<i class="fa fa-paper-plane"></i>
								</button>
							</form>
						</div>
					</div>
				</div>
			</div>
		</script>

		<!-- 聊天功能JavaScript -->
		<script>
			// 加载聊天界面HTML
			document.getElementById('app-container').innerHTML = document.getElementById('chat-template').innerHTML;
			
			// 聊天窗口切换功能
			const chatToggle = document.getElementById('chat-toggle');
			const appContainer = document.getElementById('app-container');
			
			chatToggle.addEventListener('click', () => {
				appContainer.classList.toggle('hidden');
			});

			// 聊天应用核心逻辑
			const state = {
				currentUser: null,
				users: [],
				activeConversation: null,
				conversations: {}
			};

			// DOM 元素
			const setupScreen = document.getElementById('setup-screen');
			const chatInterface = document.getElementById('chat-interface');
			const nameForm = document.getElementById('name-form');
			const usernameInput = document.getElementById('username');
			const nameError = document.getElementById('name-error');
			const userList = document.getElementById('user-list');
			const userSearch = document.getElementById('user-search');
			const currentUsername = document.getElementById('current-username');
			const currentUserInitial = document.getElementById('current-user-initial');
			const activeUsername = document.getElementById('active-username');
			const activeUserInitial = document.getElementById('active-user-initial');
			const messagesContainer = document.getElementById('messages-container');
			const messages = document.getElementById('messages');
			const noConversation = document.getElementById('no-conversation');
			const messageForm = document.getElementById('message-form');
			const messageInput = document.getElementById('message-input');
			const messageInputArea = document.getElementById('message-input-area');
			const logoutBtn = document.getElementById('logout-btn');

			// 初始化应用
			function init() {
				// 从本地存储加载数据
				loadFromLocalStorage();
				
				// 如果已有当前用户，直接进入聊天界面
				if (state.currentUser) {
					switchToChatInterface();
				}
				
				// 事件监听
				nameForm.addEventListener('submit', handleNameSubmit);
				userSearch.addEventListener('input', filterUsers);
				messageForm.addEventListener('submit', handleMessageSubmit);
				logoutBtn.addEventListener('click', handleLogout);
			}

			// 处理名字提交
			function handleNameSubmit(e) {
				e.preventDefault();
				const name = usernameInput.value.trim();
				
				// 验证名字
				if (!name) return;
				
				// 检查名字是否已存在
				if (state.users.some(user => user.name.toLowerCase() === name.toLowerCase())) {
					nameError.classList.remove('hidden');
					return;
				}
				
				// 隐藏错误提示
				nameError.classList.add('hidden');
				
				// 创建新用户
				const newUser = {
					id: Date.now().toString(),
					name: name,
					initial: name.charAt(0).toUpperCase(),
					online: true
				};
				
				// 更新状态
				state.currentUser = newUser;
				state.users.push(newUser);
				
				// 保存到本地存储
				saveToLocalStorage();
				
				// 切换到聊天界面
				switchToChatInterface();
			}

			// 切换到聊天界面
			function switchToChatInterface() {
				setupScreen.classList.add('hidden');
				chatInterface.classList.remove('hidden');
				
				// 更新当前用户信息
				currentUsername.textContent = state.currentUser.name;
				currentUserInitial.textContent = state.currentUser.initial;
				
				// 渲染用户列表
				renderUserList();
			}

			// 渲染用户列表
			function renderUserList(filteredUsers = null) {
				userList.innerHTML = '';
				const usersToRender = filteredUsers || state.users.filter(user => user.id !== state.currentUser.id);
				
				if (usersToRender.length === 0) {
					userList.innerHTML = '<p class="text-center text-gray-500 text-sm py-2">没有找到其他用户</p>';
					return;
				}
				
				usersToRender.forEach(user => {
					const userEl = document.createElement('div');
					userEl.className = `flex items-center p-2 rounded-lg cursor-pointer hover:bg-gray-100 transition-colors ${state.activeConversation === user.id ? 'bg-primary/5' : ''}`;
					userEl.innerHTML = `
						<div class="w-8 h-8 bg-primary/10 rounded-full flex items-center justify-center mr-3">
							<span class="text-primary font-medium">${user.initial}</span>
						</div>
						<div class="flex-1 min-w-0">
							<p class="font-medium text-gray-800 text-sm truncate">${user.name}</p>
						</div>
						${user.online ? '<span class="w-2 h-2 bg-green-500 rounded-full"></span>' : ''}
					`;
					
					userEl.addEventListener('click', () => startConversation(user));
					userList.appendChild(userEl);
				});
			}

			// 过滤用户
			function filterUsers() {
				const searchTerm = userSearch.value.toLowerCase().trim();
				if (!searchTerm) {
					renderUserList();
					return;
				}
				
				const filteredUsers = state.users
					.filter(user => user.id !== state.currentUser.id)
					.filter(user => user.name.toLowerCase().includes(searchTerm));
				
				renderUserList(filteredUsers);
			}

			// 开始与选定用户的对话
			function startConversation(user) {
				state.activeConversation = user.id;
				
				// 更新聊天头部
				activeUsername.textContent = user.name;
				activeUserInitial.textContent = user.initial;
				
				// 显示消息区域和输入框
				noConversation.classList.add('hidden');
				messages.classList.remove('hidden');
				messageInputArea.classList.remove('hidden');
				
				// 渲染消息
				renderMessages();
				
				// 更新用户列表选中状态
				renderUserList();
				
				// 滚动到底部
				scrollToBottom();
			}

			// 渲染消息
			function renderMessages() {
				messages.innerHTML = '';
				
				// 获取当前对话的消息
				const conversationMessages = state.conversations[state.activeConversation] || [];
				
				conversationMessages.forEach(msg => {
					const isCurrentUser = msg.senderId === state.currentUser.id;
					const messageEl = document.createElement('div');
					messageEl.className = `message-appear flex ${isCurrentUser ? 'justify-end' : 'justify-start'}`;
					messageEl.innerHTML = `
						<div class="${isCurrentUser ? 'order-2' : 'order-1'} max-w-[80%]">
							<div class="${isCurrentUser ? 'bg-primary text-white' : 'bg-white text-gray-800'} p-2 rounded-lg shadow-sm text-sm">
								<p>${formatMessage(msg.content)}</p>
							</div>
							<p class="${isCurrentUser ? 'text-right' : ''} text-xs text-gray-500 mt-1">
								${formatTime(msg.timestamp)}
							</p>
						</div>
					`;
					messages.appendChild(messageEl);
				});
			}

			// 处理消息提交
			function handleMessageSubmit(e) {
				e.preventDefault();
				const content = messageInput.value.trim();
				
				if (!content || !state.activeConversation) return;
				
				// 创建消息对象
				const message = {
					id: Date.now().toString(),
					senderId: state.currentUser.id,
					content: content,
					timestamp: new Date().toISOString()
				};
				
				// 保存消息到对话
				if (!state.conversations[state.activeConversation]) {
					state.conversations[state.activeConversation] = [];
				}
				state.conversations[state.activeConversation].push(message);
				
				// 保存到本地存储
				saveToLocalStorage();
				
				// 重新渲染消息
				renderMessages();
				
				// 清空输入框
				messageInput.value = '';
				
				// 滚动到底部
				scrollToBottom();
				
				// 模拟对方回复
				simulateReply();
			}

			// 模拟对方回复
			function simulateReply() {
				const replies = [
					"好的，我知道了",
					"这个想法不错！",
					"我稍后回复你更多信息",
					"我们可以再详细讨论一下",
					"没问题，就这么定了"
				];
				
				// 随机选择一个回复
				const randomReply = replies[Math.floor(Math.random() * replies.length)];
				
				// 1-2秒后发送回复
				setTimeout(() => {
					const reply = {
						id: (Date.now() + 1).toString(),
						senderId: state.activeConversation,
						content: randomReply,
						timestamp: new Date().toISOString()
					};
					
					// 保存回复
					state.conversations[state.activeConversation].push(reply);
					saveToLocalStorage();
					renderMessages();
					scrollToBottom();
				}, 1000 + Math.random() * 1000);
			}

			// 滚动到消息底部
			function scrollToBottom() {
				messagesContainer.scrollTop = messagesContainer.scrollHeight;
			}

			// 处理登出
			function handleLogout() {
				// 更新当前用户状态为离线
				const userIndex = state.users.findIndex(u => u.id === state.currentUser.id);
				if (userIndex !== -1) {
					state.users[userIndex].online = false;
				}
				
				// 重置状态
				state.currentUser = null;
				state.activeConversation = null;
				
				// 保存到本地存储
				saveToLocalStorage();
				
				// 切换到设置界面
				chatInterface.classList.add('hidden');
				setupScreen.classList.remove('hidden');
				usernameInput.value = '';
			}

			// 格式化消息（处理换行）
			function formatMessage(content) {
				return content.replace(/\n/g, '<br>');
			}

			// 格式化时间
			function formatTime(timestamp) {
				const date = new Date(timestamp);
				return date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
			}

			// 保存到本地存储
			function saveToLocalStorage() {
				localStorage.setItem('chatAppUsers', JSON.stringify(state.users));
				localStorage.setItem('chatAppCurrentUser', JSON.stringify(state.currentUser));
				localStorage.setItem('chatAppConversations', JSON.stringify(state.conversations));
			}

			// 从本地存储加载
			function loadFromLocalStorage() {
				const savedUsers = localStorage.getItem('chatAppUsers');
				const savedCurrentUser = localStorage.getItem('chatAppCurrentUser');
				const savedConversations = localStorage.getItem('chatAppConversations');
				
				if (savedUsers) state.users = JSON.parse(savedUsers);
				if (savedCurrentUser) state.currentUser = JSON.parse(savedCurrentUser);
				if (savedConversations) state.conversations = JSON.parse(savedConversations);
				
				// 清理离线用户
				state.users = state.users.filter(user => {
					// 如果是当前用户，标记为在线
					if (state.currentUser && user.id === state.currentUser.id) {
						user.online = true;
						return true;
					}
					return true;
				});
			}

			// 启动聊天应用
			document.addEventListener('DOMContentLoaded', init);
		</script>
		<!-- 聊天功能结束 -->

	</body>
</html>
