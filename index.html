<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="https://picsum.photos/32/32?random=lemon" type="image/png">
    <title>Lemon - ç®¡ç†ç³»ç»Ÿ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/leancloud-storage@4.12.0/dist/av-min.js"></script>
    
    <!-- Tailwindé…ç½® -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#4F86F7',
                        secondary: '#6B5CA5',
                        primary2: '#FF7F50',
                        secondary2: '#FF69B4',
                        primary3: '#2E8B57',
                        secondary3: '#8B4513',
                        accent: '#FFB344',
                        dark: '#2C3E50',
                        light: '#F8FAFC',
                    },
                    fontFamily: {
                        main: ['"Nunito"', '"Segoe UI"', 'system-ui', 'sans-serif'],
                    },
                    animation: {
                        'float': 'float 3s ease-in-out infinite',
                        'pulse-slow': 'pulse 4s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                    },
                    keyframes: {
                        float: {
                            '0%, 100%': { transform: 'translateY(0)' },
                            '50%': { transform: 'translateY(-10px)' },
                        }
                    }
                }
            }
        }
    </script>
    
    <style type="text/tailwindcss">
        @layer utilities {
            .content-auto { content-visibility: auto; }
            .text-shadow { text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1); }
            .btn-effect { @apply transition-all duration-200 hover:shadow-md active:scale-95; }
            .sidebar-btn { @apply w-full text-left px-4 py-3 rounded-xl flex items-center space-x-3 hover:bg-gray-100 hover:shadow-sm transition-all duration-200; }
            .sidebar-btn-active { @apply bg-primary/10 text-primary font-medium; }
        }
    </style>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700&display=swap" rel="stylesheet">
    
    <!-- ä¸»é¢˜æ ·å¼ -->
    <style>
        body.theme1 { --color-primary: #4F86F7; --color-secondary: #6B5CA5; --color-text: #2C3E50; --color-bg: #F8FAFC; }
        body.theme2 { --color-primary: #FF7F50; --color-secondary: #FF69B4; --color-text: #332211; --color-bg: #FFF8F5; }
        body.theme3 { --color-primary: #2E8B57; --color-secondary: #8B4513; --color-text: #222222; --color-bg: #F5F7F0; }
        
        body { background-color: var(--color-bg); color: var(--color-text); }
        .bg-primary { background-color: var(--color-primary); }
        .bg-secondary { background-color: var(--color-secondary); }
        .text-primary { color: var(--color-primary); }
        .text-secondary { color: var(--color-secondary); }
        .border-primary { border-color: var(--color-primary); }
        .gradient-primary { background: linear-gradient(to right, var(--color-primary), var(--color-secondary)); }
    </style>
</head>
<body class="min-h-screen font-main theme1">
    <!-- é¡¶éƒ¨å¯¼èˆªæ  -->
    <header class="sticky top-0 z-50 bg-white/90 backdrop-blur-md shadow-md transition-all duration-300">
        <div class="container mx-auto px-4 py-3 flex items-center justify-between">
            <!-- Logo -->
            <div class="flex items-center space-x-2">
                <div class="w-10 h-10 rounded-full gradient-primary flex items-center justify-center">
                    <i class="fa fa-lemon-o text-white text-xl"></i>
                </div>
                <h1 class="text-2xl font-bold bg-clip-text text-transparent gradient-primary">Lemon</h1>
            </div>
            
            <!-- ä¸»é¢˜åˆ‡æ¢ -->
            <div class="flex items-center space-x-2">
                <button onclick="switchTheme('theme1')" class="theme-btn px-3 py-1 rounded-md border border-primary/30 text-sm btn-effect">æ¸…æ–°è“</button>
                <button onclick="switchTheme('theme2')" class="theme-btn px-3 py-1 rounded-md border border-primary2/30 text-sm btn-effect">æ´»åŠ›æ©™</button>
                <button onclick="switchTheme('theme3')" class="theme-btn px-3 py-1 rounded-md border border-primary3/30 text-sm btn-effect">æ£®ç³»ç»¿</button>
            </div>
            
            <!-- ç”¨æˆ·åŒºåŸŸ -->
            <div class="flex items-center space-x-4">
                <div id="userMenu" class="relative">
                    <button id="userAvatarBtn" class="flex items-center space-x-2 focus:outline-none btn-effect">
                        <div id="userAvatar" class="w-10 h-10 rounded-full bg-gray-200 overflow-hidden border-2 border-primary/50 transition-transform hover:scale-110">
                            <img src="https://picsum.photos/200/200?random=1" alt="ç”¨æˆ·å¤´åƒ" class="w-full h-full object-cover">
                        </div>
                        <span id="userNickname" class="hidden md:inline font-medium">æ¸¸å®¢</span>
                        <i class="fa fa-angle-down text-gray-500"></i>
                    </button>
                    <div id="avatarDropdown" class="absolute right-0 mt-2 w-48 bg-white rounded-lg shadow-xl overflow-hidden hidden z-50">
                        <div class="p-3 border-b">
                            <p id="dropdownNickname" class="font-bold">æ¸¸å®¢</p>
                            <p id="dropdownRole" class="text-sm text-gray-500">æœªç™»å½•</p>
                        </div>
                        <button id="profileBtn" class="w-full text-left px-4 py-2 hover:bg-gray-50 transition-colors">
                            <i class="fa fa-user-circle mr-2 text-primary"></i>ä¸ªäººä¸­å¿ƒ
                        </button>
                        <button id="adminBtn" class="w-full text-left px-4 py-2 hover:bg-gray-50 transition-colors hidden">
                            <i class="fa fa-crown mr-2 text-accent"></i>ç®¡ç†ä¸­å¿ƒ
                        </button>
                        <button id="logoutBtn" class="w-full text-left px-4 py-2 hover:bg-gray-50 transition-colors">
                            <i class="fa fa-sign-out mr-2 text-red-500"></i>é€€å‡ºç™»å½•
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- ä¸»å†…å®¹åŒº -->
    <main class="container mx-auto px-4 py-6 flex flex-col md:flex-row gap-6">
        <!-- ä¾§è¾¹æ  -->
        <aside class="md:w-64 lg:w-72 shrink-0">
            <div class="bg-white rounded-2xl shadow-lg p-4 sticky top-24">
                <nav class="space-y-1">
                    <button class="sidebar-btn sidebar-btn-active" data-target="homeContent">
                        <i class="fa fa-home text-xl w-6 text-center"></i>
                        <span>é¦–é¡µ</span>
                    </button>
                    <button class="sidebar-btn" data-target="friendsContent">
                        <i class="fa fa-users text-xl w-6 text-center"></i>
                        <span>å¥½å‹åˆ—è¡¨</span>
                        <span class="ml-auto bg-primary text-white text-xs px-2 py-1 rounded-full">0</span>
                    </button>
                    <button class="sidebar-btn" data-target="qaContent">
                        <i class="fa fa-question-circle text-xl w-6 text-center"></i>
                        <span>äº’åŠ©é—®ç­”</span>
                    </button>
                    <button class="sidebar-btn" data-target="activityContent">
                        <i class="fa fa-calendar text-xl w-6 text-center"></i>
                        <span>æ´»åŠ¨ä¸­å¿ƒ</span>
                    </button>
                    <button class="sidebar-btn" data-target="noticeContent">
                        <i class="fa fa-bullhorn text-xl w-6 text-center"></i>
                        <span>é€šçŸ¥å…¬å‘Š</span>
                    </button>
                </nav>
                
                <div class="mt-6 pt-6 border-t border-gray-100">
                    <h3 class="px-4 text-sm font-medium text-gray-500 mb-2">å¿«é€Ÿé“¾æ¥</h3>
                    <nav class="space-y-1">
                        <button class="sidebar-btn">
                            <i class="fa fa-cog text-xl w-6 text-center"></i>
                            <span>ç³»ç»Ÿè®¾ç½®</span>
                        </button>
                        <button class="sidebar-btn">
                            <i class="fa fa-question-circle text-xl w-6 text-center"></i>
                            <span>å¸®åŠ©ä¸­å¿ƒ</span>
                        </button>
                    </nav>
                </div>
            </div>
        </aside>
        
        <!-- ä¸»å†…å®¹ -->
        <div class="flex-1">
            <!-- æŠ½ç­¾åŠŸèƒ½ -->
            <div id="lotterySection" class="bg-white rounded-2xl shadow-xl p-6 md:p-8 mb-6 transform transition-all hover:shadow-2xl">
                <h2 class="text-2xl font-bold mb-3 flex items-center">
                    <i class="fa fa-random text-primary mr-2"></i>ä»Šæ—¥è¿åŠ¿æŠ½ç­¾
                </h2>
                <p class="text-gray-500 mb-4">æ¯æ—¥é™æŠ½1æ¬¡ï¼Œçº¯å±å¨±ä¹~ çœ‹çœ‹ä»Šå¤©çš„å°å¹¸è¿å§ ğŸ€</p>
                
                <div class="flex flex-col md:flex-row gap-6 items-center">
                    <div class="flex-1">
                        <button id="drawLotteryBtn" class="w-full gradient-primary text-white py-3 rounded-xl font-medium btn-effect flex items-center justify-center">
                            <i class="fa fa-magic mr-2"></i>ç‚¹å‡»æŠ½ç­¾
                        </button>
                        <p id="lotteryLimitHint" class="text-center text-sm text-gray-500 mt-2 hidden">
                            ä»Šæ—¥å·²æŠ½è¿‡ç­¾ï¼Œæ˜å¤©å†æ¥å§~
                        </p>
                    </div>
                    
                    <!-- æŠ½ç­¾ç»“æœå±•ç¤ºåŒº -->
                    <div id="lotteryResult" class="w-full md:w-2/3 hidden">
                        <div class="border-2 dashed border-primary rounded-xl p-4 bg-gray-50">
                            <div class="flex flex-col items-center">
                                <h3 id="lotteryType" class="text-xl font-bold mb-2 text-primary">å¤§å‰</h3>
                                <img id="lotteryImage" src="https://picsum.photos/200/200?random=lot1" alt="ç­¾è¿å›¾ç‰‡" class="w-32 h-32 object-cover rounded-lg mb-3 shadow-md">
                                
                                <div class="w-full grid grid-cols-1 md:grid-cols-2 gap-4 mt-3">
                                    <div>
                                        <p class="text-sm font-medium text-green-600 mb-1"><i class="fa fa-check-circle mr-1"></i>å®œ</p>
                                        <p id="lotteryLucky" class="text-sm text-gray-600">å†™ä½œä¸šã€å¬éŸ³ä¹ã€å¤šå–æ°´</p>
                                    </div>
                                    <div>
                                        <p class="text-sm font-medium text-red-600 mb-1"><i class="fa fa-times-circle mr-1"></i>å¿Œ</p>
                                        <p id="lotteryUnlucky" class="text-sm text-gray-600">ç†¬å¤œã€åƒè¾›è¾£ã€ä¹…å</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- ç™»å½•/æ³¨å†Œå¡ç‰‡ -->
            <div id="authCard" class="bg-white rounded-2xl shadow-xl p-6 md:p-8 mb-6 transform transition-all hover:shadow-2xl">
                <div class="text-center mb-6">
                    <h2 class="text-3xl font-bold mb-2">æ¬¢è¿å›æ¥</h2>
                    <p class="text-gray-500">è¯·ç™»å½•ä½ çš„è´¦å·</p>
                </div>
                
                <!-- ç™»å½•è¡¨å• -->
                <div id="loginForm">
                    <div class="mb-4">
                        <label class="block text-sm font-medium mb-1" for="loginUsername">æ˜µç§°</label>
                        <div class="relative">
                            <span class="absolute inset-y-0 left-0 flex items-center pl-3 text-gray-400">
                                <i class="fa fa-user"></i>
                            </span>
                            <input type="text" id="loginUsername" placeholder="è¯·è¾“å…¥æ˜µç§°" 
                                class="w-full pl-10 pr-4 py-3 rounded-xl border-2 border-primary/30 focus:border-primary focus:ring-2 focus:ring-primary/20 outline-none transition-all"
                                value="lemon"> <!-- é»˜è®¤å¡«å……æµ‹è¯•è´¦å· -->
                        </div>
                    </div>
                    
                    <div class="mb-6">
                        <label class="block text-sm font-medium mb-1" for="loginPassword">å¯†ç </label>
                        <div class="relative">
                            <span class="absolute inset-y-0 left-0 flex items-center pl-3 text-gray-400">
                                <i class="fa fa-lock"></i>
                            </span>
                            <input type="password" id="loginPassword" placeholder="è¯·è¾“å…¥8ä½å¯†ç " 
                                class="w-full pl-10 pr-10 py-3 rounded-xl border-2 border-primary/30 focus:border-primary focus:ring-2 focus:ring-primary/20 outline-none transition-all">
                            <button type="button" class="absolute inset-y-0 right-0 flex items-center pr-3 text-gray-400 toggle-password">
                                <i class="fa fa-eye"></i>
                            </button>
                            <p id="passwordError" class="mt-1 text-xs text-red-500 hidden">å¯†ç å¿…é¡»ä¸º8ä½</p>
                        </div>
                    </div>
                    
                    <button id="loginBtn" class="w-full gradient-primary text-white py-3 rounded-xl font-medium hover:opacity-90 transition-opacity mb-4 btn-effect">
                        ç™»å½•
                    </button>
                    
                    <div class="text-center text-sm">
                        <p>è¿˜æ²¡æœ‰è´¦å·ï¼Ÿ <button id="showRegisterBtn" class="text-primary font-medium btn-effect">ç«‹å³æ³¨å†Œ</button></p>
                    </div>
                </div>
                
                <!-- æ³¨å†Œè¡¨å• -->
                <div id="registerForm" class="hidden">
                    <div class="mb-4">
                        <label class="block text-sm font-medium mb-1" for="regUsername">æ˜µç§°</label>
                        <div class="relative">
                            <span class="absolute inset-y-0 left-0 flex items-center pl-3 text-gray-400">
                                <i class="fa fa-user"></i>
                            </span>
                            <input type="text" id="regUsername" placeholder="è¯·è®¾ç½®æ˜µç§°" 
                                class="w-full pl-10 pr-4 py-3 rounded-xl border-2 border-primary/30 focus:border-primary focus:ring-2 focus:ring-primary/20 outline-none transition-all">
                        </div>
                    </div>
                    
                    <div class="mb-6">
                        <label class="block text-sm font-medium mb-1" for="regPassword">å¯†ç </label>
                        <div class="relative">
                            <span class="absolute inset-y-0 left-0 flex items-center pl-3 text-gray-400">
                                <i class="fa fa-lock"></i>
                            </span>
                            <input type="password" id="regPassword" placeholder="è¯·è®¾ç½®8ä½å¯†ç " 
                                class="w-full pl-10 pr-10 py-3 rounded-xl border-2 border-primary/30 focus:border-primary focus:ring-2 focus:ring-primary/20 outline-none transition-all">
                            <button type="button" class="absolute inset-y-0 right-0 flex items-center pr-3 text-gray-400 toggle-password">
                                <i class="fa fa-eye"></i>
                            </button>
                            <p id="regPasswordError" class="mt-1 text-xs text-red-500 hidden">å¯†ç å¿…é¡»ä¸º8ä½</p>
                        </div>
                    </div>
                    
                    <button id="registerBtn" class="w-full gradient-primary text-white py-3 rounded-xl font-medium hover:opacity-90 transition-opacity mb-4 btn-effect">
                        æ³¨å†Œ
                    </button>
                    
                    <div class="text-center text-sm">
                        <p>å·²æœ‰è´¦å·ï¼Ÿ <button id="showLoginBtn" class="text-primary font-medium btn-effect">ç«‹å³ç™»å½•</button></p>
                    </div>
                </div>
            </div>
            
            <!-- é¦–é¡µå†…å®¹ï¼ˆç™»å½•åæ˜¾ç¤ºï¼‰ -->
            <div id="homeContent" class="hidden">
                <div class="bg-gradient-to-r from-primary/10 to-secondary/10 rounded-2xl p-6 md:p-8 mb-6 relative overflow-hidden">
                    <div class="absolute top-0 right-0 w-40 h-40 bg-accent/10 rounded-full -mr-20 -mt-20"></div>
                    <div class="absolute bottom-0 left-0 w-60 h-60 bg-primary/10 rounded-full -ml-30 -mb-30"></div>
                    
                    <div class="relative z-10 flex flex-col md:flex-row items-start md:items-center justify-between">
                        <div>
                            <h2 class="text-2xl md:text-3xl font-bold mb-2">æ¬¢è¿å›æ¥ï¼Œ<span id="welcomeNickname">ç”¨æˆ·</span>ï¼</h2>
                            <p class="text-gray-600" id="welcomeRole">æ™®é€šç”¨æˆ·</p>
                        </div>
                        
                        <div class="mt-4 md:mt-0 flex space-x-3">
                            <button class="bg-white text-primary px-4 py-2 rounded-lg shadow hover:shadow-md transition-shadow flex items-center btn-effect">
                                <i class="fa fa-plus mr-2"></i>å‘å¸ƒåŠ¨æ€
                            </button>
                            <button class="bg-white text-secondary px-4 py-2 rounded-lg shadow hover:shadow-md transition-shadow btn-effect">
                                <i class="fa fa-envelope"></i>
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- åŠŸèƒ½å¡ç‰‡ -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-6">
                    <div class="bg-white rounded-2xl shadow-lg p-6 hover:shadow-xl transition-shadow transform hover:-translate-y-1 duration-300">
                        <div class="w-12 h-12 bg-primary/20 rounded-xl flex items-center justify-center mb-4">
                            <i class="fa fa-users text-primary text-xl"></i>
                        </div>
                        <h3 class="text-xl font-bold mb-2">å¥½å‹ç®¡ç†</h3>
                        <p class="text-gray-600 text-sm mb-4">æŸ¥çœ‹å¥½å‹åˆ—è¡¨ï¼Œæ·»åŠ æ–°å¥½å‹ï¼Œç»´ç³»ç¤¾äº¤å…³ç³»</p>
                        <button id="toFriendsBtn" class="text-primary font-medium flex items-center btn-effect">
                            æŸ¥çœ‹å¥½å‹ <i class="fa fa-arrow-right ml-2"></i>
                        </button>
                    </div>
                    
                    <div class="bg-white rounded-2xl shadow-lg p-6 hover:shadow-xl transition-shadow transform hover:-translate-y-1 duration-300">
                        <div class="w-12 h-12 bg-secondary/20 rounded-xl flex items-center justify-center mb-4">
                            <i class="fa fa-question-circle text-secondary text-xl"></i>
                        </div>
                        <h3 class="text-xl font-bold mb-2">äº’åŠ©é—®ç­”</h3>
                        <p class="text-gray-600 text-sm mb-4">æå‡ºä½ çš„ç–‘é—®ï¼Œè§£ç­”ä»–äººå›°æƒ‘ï¼Œå…±åŒè¿›æ­¥</p>
                        <button class="text-secondary font-medium flex items-center btn-effect">
                            è¿›å…¥é—®ç­” <i class="fa fa-arrow-right ml-2"></i>
                        </button>
                    </div>
                    
                    <div class="bg-white rounded-2xl shadow-lg p-6 hover:shadow-xl transition-shadow transform hover:-translate-y-1 duration-300">
                        <div class="w-12 h-12 bg-accent/20 rounded-xl flex items-center justify-center mb-4">
                            <i class="fa fa-calendar text-accent text-xl"></i>
                        </div>
                        <h3 class="text-xl font-bold mb-2">æ´»åŠ¨ä¸­å¿ƒ</h3>
                        <p class="text-gray-600 text-sm mb-4">æµè§ˆæœ€æ–°æ´»åŠ¨ï¼ŒæŠ¥åå‚ä¸ï¼Œä¸°å¯Œç”Ÿæ´»</p>
                        <button class="text-accent font-medium flex items-center btn-effect">
                            æŸ¥çœ‹æ´»åŠ¨ <i class="fa fa-arrow-right ml-2"></i>
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- å…¶ä»–é¡µé¢å†…å®¹ -->
            <div id="friendsContent" class="hidden"><div class="bg-white rounded-2xl shadow-lg p-6 mb-6"><h2 class="text-2xl font-bold mb-4">å¥½å‹åˆ—è¡¨</h2></div></div>
            <div id="qaContent" class="hidden"><div class="bg-white rounded-2xl shadow-lg p-6 mb-6"><h2 class="text-2xl font-bold mb-4">äº’åŠ©é—®ç­”</h2></div></div>
            <div id="activityContent" class="hidden"><div class="bg-white rounded-2xl shadow-lg p-6 mb-6"><h2 class="text-2xl font-bold mb-4">æ´»åŠ¨ä¸­å¿ƒ</h2></div></div>
            <div id="noticeContent" class="hidden"><div class="bg-white rounded-2xl shadow-lg p-6 mb-6"><h2 class="text-2xl font-bold mb-4">é€šçŸ¥å…¬å‘Š</h2></div></div>
            <div id="profileContent" class="hidden"><div class="bg-white rounded-2xl shadow-lg p-6 mb-6"><h2 class="text-2xl font-bold mb-4">ä¸ªäººä¸­å¿ƒ</h2></div></div>
            <div id="adminContent" class="hidden"><div class="bg-white rounded-2xl shadow-lg p-6 mb-6"><h2 class="text-2xl font-bold mb-4">ç®¡ç†ä¸­å¿ƒ</h2></div></div>
        </div>
    </main>

    <!-- é¡µè„š -->
    <footer class="bg-dark text-white py-10 mt-10">
        <div class="container mx-auto px-4">
            <div class="flex flex-col md:flex-row justify-between">
                <div class="mb-6 md:mb-0">
                    <div class="flex items-center space-x-2 mb-4">
                        <div class="w-10 h-10 rounded-full gradient-primary flex items-center justify-center">
                            <i class="fa fa-lemon-o text-white text-xl"></i>
                        </div>
                        <h2 class="text-2xl font-bold">Lemon</h2>
                    </div>
                    <p class="text-gray-400 max-w-md">ç®€æ´é«˜æ•ˆçš„ç®¡ç†ç³»ç»Ÿï¼Œè¿æ¥æ¯ä¸€ä½ç”¨æˆ·ï¼Œæä¾›ä¼˜è´¨ä½“éªŒã€‚</p>
                </div>
                
                <div class="grid grid-cols-2 md:grid-cols-3 gap-8">
                    <div>
                        <h3 class="text-lg font-bold mb-4">å¿«é€Ÿé“¾æ¥</h3>
                        <ul class="space-y-2 text-gray-400">
                            <li><a href="#" class="hover:text-primary transition-colors">é¦–é¡µ</a></li>
                            <li><a href="#" class="hover:text-primary transition-colors">äº’åŠ©é—®ç­”</a></li>
                            <li><a href="#" class="hover:text-primary transition-colors">æ´»åŠ¨ä¸­å¿ƒ</a></li>
                        </ul>
                    </div>
                    
                    <div>
                        <h3 class="text-lg font-bold mb-4">å…³äºæˆ‘ä»¬</h3>
                        <ul class="space-y-2 text-gray-400">
                            <li><a href="#" class="hover:text-primary transition-colors">å…³äºç³»ç»Ÿ</a></li>
                            <li><a href="#" class="hover:text-primary transition-colors">ä½¿ç”¨å¸®åŠ©</a></li>
                            <li><a href="#" class="hover:text-primary transition-colors">è”ç³»æˆ‘ä»¬</a></li>
                        </ul>
                    </div>
                </div>
            </div>
            
            <div class="border-t border-white/10 mt-8 pt-8 text-center text-gray-500 text-sm">
                <p>Â© 2025 lemonç‰ˆæƒæ‰€æœ‰</p>
            </div>
        </div>
    </footer>

    <!-- æç¤ºå¼¹çª— -->
    <div id="successToast" class="fixed bottom-6 right-6 bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg transform translate-y-20 opacity-0 transition-all duration-300 flex items-center z-50">
        <i class="fa fa-check-circle mr-2"></i>
        <span id="successMessage">æ“ä½œæˆåŠŸ</span>
    </div>
    <div id="errorToast" class="fixed bottom-6 right-6 bg-red-500 text-white px-6 py-3 rounded-lg shadow-lg transform translate-y-20 opacity-0 transition-all duration-300 flex items-center z-50">
        <i class="fa fa-exclamation-circle mr-2"></i>
        <span id="errorMessage">æ“ä½œå¤±è´¥</span>
    </div>

    <script>
        // å…³é”®ä¿®å¤1ï¼šæ­£ç¡®åˆå§‹åŒ–LeanCloudï¼ˆä½¿ç”¨ä½ æä¾›çš„æœ‰æ•ˆå¯†é’¥ï¼‰
        AV.init({
            appId: "30kUc571qTv0YSCTWVGRbAxk-gzGzoHsz",
            appKey: "LxFqgqjRZ3SaRGYUGznRiWAr",
            serverURL: "https://30kuc571.lc-cn-n1-shared.com"
        });

        // é…ç½®å’ŒçŠ¶æ€ç®¡ç†
        const Config = { ROLES: { SUPER_ADMIN: 'super_admin', ADMIN: 'admin', USER: 'user' } };
        const State = { currentUser: null, currentRole: Config.ROLES.USER, isLoggedIn: false };

        // æŠ½ç­¾æ•°æ®
        const LotteryData = {
            types: [
                { name: "å¤§å‰", icon: "https://picsum.photos/200/200?random=lot1", description: "è¿åŠ¿æä½³" },
                { name: "å°å‰", icon: "https://picsum.photos/200/200?random=lot2", description: "å°æœ‰å¥½è¿" },
                { name: "ä¸­å¹³", icon: "https://picsum.photos/200/200?random=lot3", description: "è¿åŠ¿å¹³å¹³" },
                { name: "å‡¶", icon: "https://picsum.photos/200/200?random=lot4", description: "éœ€è°¨æ…è¡Œäº‹" },
                { name: "å¤§å‡¶", icon: "https://picsum.photos/200/200?random=lot5", description: "ä¸‡äº‹å°å¿ƒ" }
            ],
            lucky: ["å†™ä½œä¸š", "å¬éŸ³ä¹", "å¤šå–æ°´", "æ•£æ­¥", "é˜…è¯»"],
            unlucky: ["ç†¬å¤œ", "åƒè¾›è¾£", "ä¹…å", "å‘è„¾æ°”", "æ‹–å»¶"]
        };

        // å·¥å…·å‡½æ•°
        const Utils = {
            showToast: (type, message) => {
                const toast = document.getElementById(`${type}Toast`);
                const msgEl = document.getElementById(`${type}Message`);
                msgEl.textContent = message;
                toast.classList.remove('translate-y-20', 'opacity-0');
                setTimeout(() => toast.classList.add('translate-y-20', 'opacity-0'), 3000);
            },
            randomPick: (arr, count = 3) => [...arr].sort(() => 0.5 - Math.random()).slice(0, count).join('ã€'),
            getToday: () => {
                const d = new Date();
                return `${d.getFullYear()}-${(d.getMonth()+1).toString().padStart(2, '0')}-${d.getDate().toString().padStart(2, '0')}`;
            }
        };

        // æŠ½ç­¾åŠŸèƒ½
        const Lottery = {
            init: () => {
                const lastDraw = localStorage.getItem('lastLotteryDate');
                if (lastDraw === Utils.getToday()) {
                    document.getElementById('drawLotteryBtn').classList.add('hidden');
                    document.getElementById('lotteryLimitHint').classList.remove('hidden');
                    Lottery.showLastResult();
                }
            },
            draw: () => {
                const today = Utils.getToday();
                const type = LotteryData.types[Math.floor(Math.random() * LotteryData.types.length)];
                const result = {
                    type: type,
                    lucky: Utils.randomPick(LotteryData.lucky),
                    unlucky: Utils.randomPick(LotteryData.unlucky),
                    date: today
                };
                localStorage.setItem('lastLotteryResult', JSON.stringify(result));
                localStorage.setItem('lastLotteryDate', today);
                Lottery.showResult(result);
                document.getElementById('drawLotteryBtn').classList.add('hidden');
                document.getElementById('lotteryLimitHint').classList.remove('hidden');
            },
            showResult: (result) => {
                document.getElementById('lotteryResult').classList.remove('hidden');
                document.getElementById('lotteryType').textContent = result.type.name;
                document.getElementById('lotteryImage').src = result.type.icon;
                document.getElementById('lotteryLucky').textContent = result.lucky;
                document.getElementById('lotteryUnlucky').textContent = result.unlucky;
            },
            showLastResult: () => {
                const res = localStorage.getItem('lastLotteryResult');
                if (res) Lottery.showResult(JSON.parse(res));
            }
        };

        // ä¸»é¢˜åˆ‡æ¢
        function switchTheme(theme) {
            document.body.classList.remove('theme1', 'theme2', 'theme3');
            document.body.classList.add(theme);
            localStorage.setItem('preferredTheme', theme);
            Utils.showToast('success', `å·²åˆ‡æ¢åˆ°${theme === 'theme1' ? 'æ¸…æ–°è“' : theme === 'theme2' ? 'æ´»åŠ›æ©™' : 'æ£®ç³»ç»¿'}ä¸»é¢˜`);
        }

        // å…³é”®ä¿®å¤2ï¼šç™»å½•åŠŸèƒ½ï¼ˆç¡®ä¿äº‹ä»¶ç»‘å®šå’Œé€»è¾‘å®Œæ•´ï¼‰
        const Auth = {
            init: async () => {
                try {
                    await Auth.ensureSuperAdminExists();
                    const user = AV.User.current();
                    if (user) {
                        State.currentUser = user.toJSON();
                        State.isLoggedIn = true;
                        await Auth.checkUserRole();
                        Auth.updateUserDisplay();
                        UI.showContent('homeContent');
                    } else {
                        UI.showContent('authCard');
                    }
                    const savedTheme = localStorage.getItem('preferredTheme');
                    if (savedTheme) switchTheme(savedTheme);
                } catch (err) {
                    console.error('åˆå§‹åŒ–å¤±è´¥:', err);
                    Utils.showToast('error', 'ç³»ç»Ÿåˆå§‹åŒ–å¤±è´¥ï¼Œè¯·åˆ·æ–°é‡è¯•');
                }
            },
            
            // ç¡®ä¿ç®¡ç†å‘˜è´¦å·å¯ç”¨ï¼ˆæµ‹è¯•ç”¨ï¼šè´¦å·lemonï¼Œå¯†ç ning6666ï¼‰
            ensureSuperAdminExists: async () => {
                try {
                    // æ£€æŸ¥ç®¡ç†å‘˜è§’è‰²
                    let roleQuery = new AV.Query(AV.Role);
                    roleQuery.equalTo('name', Config.ROLES.SUPER_ADMIN);
                    let roles = await roleQuery.find();
                    if (roles.length === 0) {
                        let role = new AV.Role(Config.ROLES.SUPER_ADMIN, new AV.ACL());
                        role.getACL().setPublicReadAccess(true);
                        await role.save();
                    }
                    
                    // æ£€æŸ¥æµ‹è¯•è´¦å·æ˜¯å¦å­˜åœ¨
                    let userQuery = new AV.Query(AV.User);
                    userQuery.equalTo('username', 'lemon');
                    let users = await userQuery.find();
                    if (users.length === 0) {
                        let user = new AV.User();
                        user.setUsername('lemon');
                        user.setPassword('ning6666'); // 8ä½å¯†ç ï¼Œç¬¦åˆè¦æ±‚
                        await user.signUp();
                    }
                } catch (err) {
                    console.error('ç®¡ç†å‘˜è´¦å·æ£€æŸ¥å¤±è´¥:', err);
                }
            },
            
            // ç™»å½•æ ¸å¿ƒé€»è¾‘ï¼ˆä¿®å¤æ— å“åº”é—®é¢˜ï¼‰
            login: async (username, password) => {
                if (password.length !== 8) {
                    document.getElementById('passwordError').classList.remove('hidden');
                    return false;
                }
                
                try {
                    await AV.User.logOut(); // æ¸…é™¤æ—§ç™»å½•çŠ¶æ€
                    const user = await AV.User.logIn(username, password);
                    State.currentUser = user.toJSON();
                    State.isLoggedIn = true;
                    await Auth.checkUserRole();
                    Auth.updateUserDisplay();
                    Utils.showToast('success', 'ç™»å½•æˆåŠŸï¼');
                    return true;
                } catch (err) {
                    console.error('ç™»å½•å¤±è´¥:', err);
                    let msg = 'ç™»å½•å¤±è´¥';
                    if (err.code === 210) msg = 'ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯';
                    else if (err.code === 211) msg = 'ç”¨æˆ·ä¸å­˜åœ¨';
                    Utils.showToast('error', msg);
                    return false;
                }
            },
            
            register: async (username, password) => {
                if (password.length !== 8) {
                    document.getElementById('regPasswordError').classList.remove('hidden');
                    return false;
                }
                
                try {
                    let query = new AV.Query(AV.User);
                    query.equalTo('username', username);
                    let users = await query.find();
                    if (users.length > 0) {
                        Utils.showToast('error', 'ç”¨æˆ·åå·²å­˜åœ¨');
                        return false;
                    }
                    
                    let user = new AV.User();
                    user.setUsername(username);
                    user.setPassword(password);
                    await user.signUp();
                    Utils.showToast('success', 'æ³¨å†ŒæˆåŠŸï¼Œè¯·ç™»å½•');
                    return true;
                } catch (err) {
                    console.error('æ³¨å†Œå¤±è´¥:', err);
                    Utils.showToast('error', 'æ³¨å†Œå¤±è´¥ï¼Œè¯·ç¨åå†è¯•');
                    return false;
                }
            },
            
            logout: async () => {
                await AV.User.logOut();
                State.currentUser = null;
                State.isLoggedIn = false;
                Auth.updateUserDisplay();
                UI.showContent('authCard');
                Utils.showToast('success', 'å·²é€€å‡ºç™»å½•');
            },
            
            updateUserDisplay: () => {
                const avatar = document.getElementById('userAvatar');
                const nickname = document.getElementById('userNickname');
                const dropdownNick = document.getElementById('dropdownNickname');
                const dropdownRole = document.getElementById('dropdownRole');
                const adminBtn = document.getElementById('adminBtn');
                const welcomeNick = document.getElementById('welcomeNickname');
                
                if (State.isLoggedIn) {
                    const avatarUrl = State.currentUser.avatar || `https://picsum.photos/200/200?random=${State.currentUser.objectId}`;
                    avatar.innerHTML = `<img src="${avatarUrl}" alt="ç”¨æˆ·å¤´åƒ" class="w-full h-full object-cover">`;
                    nickname.textContent = State.currentUser.username;
                    dropdownNick.textContent = State.currentUser.username;
                    welcomeNick.textContent = State.currentUser.username;
                    
                    let roleText = 'æ™®é€šç”¨æˆ·';
                    if (State.currentRole === Config.ROLES.SUPER_ADMIN) {
                        roleText = 'ğŸ‘‘è¶…çº§ç®¡ç†å‘˜';
                        adminBtn.classList.remove('hidden');
                    } else if (State.currentRole === Config.ROLES.ADMIN) {
                        roleText = 'ğŸ›¡ï¸ç®¡ç†å‘˜';
                        adminBtn.classList.remove('hidden');
                    } else {
                        adminBtn.classList.add('hidden');
                    }
                    dropdownRole.textContent = roleText;
                } else {
                    avatar.innerHTML = `<img src="https://picsum.photos/200/200?random=1" alt="æ¸¸å®¢å¤´åƒ">`;
                    nickname.textContent = 'æ¸¸å®¢';
                    dropdownNick.textContent = 'æ¸¸å®¢';
                    dropdownRole.textContent = 'æœªç™»å½•';
                    adminBtn.classList.add('hidden');
                }
            },
            
            checkUserRole: async () => {
                if (!State.currentUser) return;
                try {
                    const user = AV.Object.createWithoutData('_User', State.currentUser.objectId);
                    const query = new AV.Query(AV.Role);
                    query.equalTo('users', user);
                    const roles = await query.find();
                    
                    State.currentRole = roles.some(r => r.get('name') === Config.ROLES.SUPER_ADMIN) 
                        ? Config.ROLES.SUPER_ADMIN 
                        : roles.some(r => r.get('name') === Config.ROLES.ADMIN)
                            ? Config.ROLES.ADMIN
                            : Config.ROLES.USER;
                } catch (err) {
                    console.error('è·å–è§’è‰²å¤±è´¥:', err);
                    State.currentRole = Config.ROLES.USER;
                }
            }
        };

        // UIæ§åˆ¶
        const UI = {
            showContent: (id) => {
                document.querySelectorAll('main > div > div[id$="Content"], #authCard').forEach(el => el.classList.add('hidden'));
                document.getElementById(id).classList.remove('hidden');
                document.querySelectorAll('.sidebar-btn').forEach(btn => btn.classList.remove('sidebar-btn-active'));
                document.querySelector(`.sidebar-btn[data-target="${id}"]`)?.classList.add('sidebar-btn-active');
            }
        };

        // å…³é”®ä¿®å¤3ï¼šç¡®ä¿ç™»å½•æŒ‰é’®äº‹ä»¶æ­£ç¡®ç»‘å®šï¼ˆDOMåŠ è½½å®Œæˆåæ‰§è¡Œï¼‰
        document.addEventListener('DOMContentLoaded', () => {
            // åˆå§‹åŒ–åŠŸèƒ½
            Auth.init();
            Lottery.init();
            
            // ç™»å½•æŒ‰é’®ç‚¹å‡»äº‹ä»¶ï¼ˆæ ¸å¿ƒä¿®å¤ï¼šç¡®ä¿èƒ½è§¦å‘ç™»å½•é€»è¾‘ï¼‰
            document.getElementById('loginBtn').addEventListener('click', async () => {
                const username = document.getElementById('loginUsername').value.trim();
                const password = document.getElementById('loginPassword').value;
                
                if (!username || !password) {
                    Utils.showToast('error', 'è¯·è¾“å…¥ç”¨æˆ·åå’Œå¯†ç ');
                    return;
                }
                
                const success = await Auth.login(username, password);
                if (success) {
                    UI.showContent('homeContent'); // ç™»å½•æˆåŠŸåè·³è½¬åˆ°é¦–é¡µ
                }
            });
            
            // æ³¨å†ŒæŒ‰é’®
            document.getElementById('registerBtn').addEventListener('click', async () => {
                const username = document.getElementById('regUsername').value.trim();
                const password = document.getElementById('regPassword').value;
                
                if (!username || !password) {
                    Utils.showToast('error', 'è¯·è¾“å…¥ç”¨æˆ·åå’Œå¯†ç ');
                    return;
                }
                
                const success = await Auth.register(username, password);
                if (success) {
                    document.getElementById('registerForm').classList.add('hidden');
                    document.getElementById('loginForm').classList.remove('hidden');
                }
            });
            
            // å…¶ä»–äº‹ä»¶ç»‘å®š
            document.getElementById('showRegisterBtn').addEventListener('click', () => {
                document.getElementById('loginForm').classList.add('hidden');
                document.getElementById('registerForm').classList.remove('hidden');
            });
            document.getElementById('showLoginBtn').addEventListener('click', () => {
                document.getElementById('registerForm').classList.add('hidden');
                document.getElementById('loginForm').classList.remove('hidden');
            });
            document.getElementById('logoutBtn').addEventListener('click', () => Auth.logout());
            document.getElementById('drawLotteryBtn').addEventListener('click', () => Lottery.draw());
            document.getElementById('userAvatarBtn').addEventListener('click', () => {
                document.getElementById('avatarDropdown').classList.toggle('hidden');
            });
            document.querySelectorAll('.sidebar-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    const target = btn.getAttribute('data-target');
                    if (target && State.isLoggedIn) UI.showContent(target);
                    else if (!State.isLoggedIn) Utils.showToast('error', 'è¯·å…ˆç™»å½•');
                });
            });
            document.querySelectorAll('.toggle-password').forEach(btn => {
                btn.addEventListener('click', function() {
                    const input = this.parentElement.querySelector('input');
                    const icon = this.querySelector('i');
                    input.type = input.type === 'password' ? 'text' : 'password';
                    icon.classList.toggle('fa-eye');
                    icon.classList.toggle('fa-eye-slash');
                });
            });
            document.getElementById('loginPassword').addEventListener('input', (e) => {
                document.getElementById('passwordError').classList.toggle('hidden', e.target.value.length === 8);
            });
            document.getElementById('regPassword').addEventListener('input', (e) => {
                document.getElementById('regPasswordError').classList.toggle('hidden', e.target.value.length === 8);
            });
            document.addEventListener('click', (e) => {
                if (!document.getElementById('userMenu').contains(e.target)) {
                    document.getElementById('avatarDropdown').classList.add('hidden');
                }
            });
        });
    </script>
</body>
</html>
    
